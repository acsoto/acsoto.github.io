{"componentChunkName":"component---src-templates-blog-post-js","path":"/TakeawayDelivery-back/","result":{"data":{"site":{"siteMetadata":{"title":"SOTO"}},"markdownRemark":{"id":"88cd875a-3cf1-5134-b80d-92b901cf3ba5","tableOfContents":"<ul>\n<li>\n<p><a href=\"#takeawaydelivery-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0\">TakeawayDelivery 后端实现</a></p>\n<ul>\n<li>\n<p><a href=\"#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83\">开发环境</a></p>\n</li>\n<li>\n<p><a href=\"#%E4%BA%91%E7%AB%AF%E9%83%A8%E7%BD%B2\">云端部署</a></p>\n</li>\n<li>\n<p><a href=\"#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%84\">数据库结构</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3\">后端实现接口</a></p>\n</li>\n<li>\n<p><a href=\"#%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0\">深度学习</a></p>\n</li>\n<li>\n<p><a href=\"#orm\">ORM</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%AE%9E%E7%8E%B0%E6%A0%B7%E4%BE%8B\">实现样例</a></p>\n</li>\n<li>\n<p><a href=\"#%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86\">密码加密</a></p>\n</li>\n<li>\n<p><a href=\"#%E8%AE%BE%E8%AE%A1%E7%BB%86%E8%8A%82\">设计细节</a></p>\n<ul>\n<li><a href=\"#%E7%83%AD%E8%8F%9C%E6%8E%A8%E8%8D%90\">热菜推荐</a></li>\n<li><a href=\"#%E6%8C%89%E6%97%B6%E9%97%B4%E5%B1%95%E7%A4%BA\">按时间展示</a></li>\n<li><a href=\"#%E4%B8%8B%E5%8D%95%E9%80%81%E5%8D%95\">下单&#x26;送单</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7\">数据完整性</a></p>\n</li>\n</ul>\n</li>\n</ul>","excerpt":"TakeawayDelivery 后端实现 开发环境 Python Django PyTorch MySQL 云端部署 我们将后端Django和数据库均部署在服务器上，并且进行了域名解析，可以通过delivery.mcatk.com直接访问后端，前端可以在任意情况下发送请求。 …","html":"<h1 id=\"takeawaydelivery-后端实现\" style=\"position:relative;\"><a href=\"#takeawaydelivery-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0\" aria-label=\"takeawaydelivery 后端实现 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TakeawayDelivery 后端实现</h1>\n<h2 id=\"开发环境\" style=\"position:relative;\"><a href=\"#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83\" aria-label=\"开发环境 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>开发环境</h2>\n<ul>\n<li>Python</li>\n<li>Django</li>\n<li>PyTorch</li>\n<li>MySQL</li>\n</ul>\n<h2 id=\"云端部署\" style=\"position:relative;\"><a href=\"#%E4%BA%91%E7%AB%AF%E9%83%A8%E7%BD%B2\" aria-label=\"云端部署 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>云端部署</h2>\n<p>我们将后端Django和数据库均部署在服务器上，并且进行了域名解析，可以通过delivery.mcatk.com直接访问后端，前端可以在任意情况下发送请求。</p>\n<p>服务器供应：腾讯云&#x26;阿里云\n服务器系统：CentOS 7\n数据库：MySQL 5\n解释器：Anaconda 3</p>\n<h2 id=\"数据库结构\" style=\"position:relative;\"><a href=\"#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%84\" aria-label=\"数据库结构 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>数据库结构</h2>\n<p><img src=\"https://pic.mcac.cc/soto-pictures/2021-12/SRvqwx.png\" alt=\"数据库结构\"></p>\n<h2 id=\"后端实现接口\" style=\"position:relative;\"><a href=\"#%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3\" aria-label=\"后端实现接口 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>后端实现接口</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">path<span class=\"token punctuation\">(</span><span class=\"token string\">'api/login/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>login<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/register/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/getInformation/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>get_information<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/changeInformation/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>change_information<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/changePassword/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>change_password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/getStores/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>get_stores<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/getStoreInformation/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>get_store_information<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/deleteUser/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>delete_user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/getEvaluateFood/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>get_evaluate_food<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/evaluateFood/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>evaluate_food<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/deleteEvaluateFood/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>delete_evaluate_food<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/getEvaluateUser/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>get_evaluate_user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/evaluateUser/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>evaluate_user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/deleteEvaluateUser/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>delete_evaluate_user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/setOrders/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>set_orders<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/unStar/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>un_star<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/setStar/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>set_star<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/finishOrder/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>finish_order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/takeOrder/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>take_order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/getAllOrders/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>get_all_orders<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/getTopFoodList/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>get_top_food_list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/androidGetUserFoodEvaluate/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>android_get_user_food_evaluate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \npath<span class=\"token punctuation\">(</span><span class=\"token string\">'api/androidGetFoodEvaluateScore/'</span><span class=\"token punctuation\">,</span> myapp<span class=\"token punctuation\">.</span>views<span class=\"token punctuation\">.</span>android_get_food_evaluate_score<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h2 id=\"深度学习\" style=\"position:relative;\"><a href=\"#%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0\" aria-label=\"深度学习 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>深度学习</h2>\n<p>我们根据订单的配送时间是星期几，餐厅，配送地等信息通过深度学习预测订单送达时间\n我们通过手动构造数据集，训练了一个模型存到服务器，并在每次前端发送新的请求后对订单进行预计送达时间的计算。</p>\n<p><img src=\"https://pic.mcac.cc/soto-pictures/2021-12/wzVMGd.png\" alt=\"\"></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">predict</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">,</span>dl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  \n    model<span class=\"token punctuation\">.</span><span class=\"token builtin\">eval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n    <span class=\"token keyword\">with</span> torch<span class=\"token punctuation\">.</span>no_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  \n        result <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span>torch<span class=\"token punctuation\">.</span>FloatTensor<span class=\"token punctuation\">(</span>dl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  \n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">65.0</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"orm\" style=\"position:relative;\"><a href=\"#orm\" aria-label=\"orm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ORM</h2>\n<p>我们通过Django ORM生成了数据表对象的models，方便了数据库的操作，例如</p>\n<p>Food</p>\n<p><img src=\"https://pic.mcac.cc/soto-pictures/2021-12/C1MOdS.png\" alt=\"Food\"></p>\n<p>实现为</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Food</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  \n    food_id <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>AutoField<span class=\"token punctuation\">(</span>primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>  \n    food_name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>  \n    food_price <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DecimalField<span class=\"token punctuation\">(</span>max_digits<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> decimal_places<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>  \n    food_url <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>  \n    food_type <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>  \n    store <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span><span class=\"token string\">'Store'</span><span class=\"token punctuation\">,</span> models<span class=\"token punctuation\">.</span>DO_NOTHING<span class=\"token punctuation\">,</span> blank<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> null<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>  \n  \n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>  \n        managed <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>  \n db_table <span class=\"token operator\">=</span> <span class=\"token string\">'food'</span></code></pre></div>\n<h2 id=\"实现样例\" style=\"position:relative;\"><a href=\"#%E5%AE%9E%E7%8E%B0%E6%A0%B7%E4%BE%8B\" aria-label=\"实现样例 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>实现样例</h2>\n<ol>\n<li>【增】用户注册</li>\n</ol>\n<p>前端发送post请求\nURL: <code class=\"language-text\">http://delivery.mcatk.com/api/register/</code>\nPARA:  <code class=\"language-text\">userName</code>  <code class=\"language-text\">userPassword</code> <code class=\"language-text\">userNickname</code> <code class=\"language-text\">userTel</code> <code class=\"language-text\">userAddress</code></p>\n<p>后端接到请求，执行<code class=\"language-text\">register</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">register</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">:</span>\n        data_json <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span>\n        new_name <span class=\"token operator\">=</span> data_json<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"userName\"</span><span class=\"token punctuation\">)</span>\n        new_pwd <span class=\"token operator\">=</span> make_password<span class=\"token punctuation\">(</span>data_json<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"userPassword\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        new_nickname <span class=\"token operator\">=</span> data_json<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"userNickname\"</span><span class=\"token punctuation\">)</span>\n        new_tel <span class=\"token operator\">=</span> data_json<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"userTel\"</span><span class=\"token punctuation\">)</span>\n        new_address <span class=\"token operator\">=</span> data_json<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"userAddress\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> new_name <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"未输入\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            space <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>user_name<span class=\"token operator\">=</span>new_name<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>space<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"用户名已存在\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                new_user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                new_user<span class=\"token punctuation\">.</span>user_name <span class=\"token operator\">=</span> new_name\n                new_user<span class=\"token punctuation\">.</span>user_password <span class=\"token operator\">=</span> new_pwd\n                new_user<span class=\"token punctuation\">.</span>user_nickname <span class=\"token operator\">=</span> new_nickname\n                new_user<span class=\"token punctuation\">.</span>user_tel <span class=\"token operator\">=</span> new_tel\n                new_user<span class=\"token punctuation\">.</span>user_address <span class=\"token operator\">=</span> new_address\n                new_user<span class=\"token punctuation\">.</span>user_icon_url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://img0.baidu.com/it/u=3730772664,138405132&amp;fm=26&amp;fmt=auto\"</span>\n                new_user<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"注册成功\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"userID\"</span><span class=\"token punctuation\">:</span> new_user<span class=\"token punctuation\">.</span>user_id<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"请求异常\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>先检查是否有重名用户，若无，通过Django ORM 将新生成的User导入数据库。</p>\n<ol start=\"2\">\n<li>【删】用户注销</li>\n</ol>\n<p>前端发送post请求\nURL: <code class=\"language-text\">http://delivery.mcatk.com/api/deleteUser/</code>\nPARA:  <code class=\"language-text\">userID</code>  <code class=\"language-text\">userPassword</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">delete_user</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">:</span>\n        data_json <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span>\n        user_id <span class=\"token operator\">=</span> data_json<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"userID\"</span><span class=\"token punctuation\">)</span>\n        password <span class=\"token operator\">=</span> data_json<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"userPassword\"</span><span class=\"token punctuation\">)</span>\n        user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>user_id<span class=\"token operator\">=</span>user_id<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> check_password<span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span>user_password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            user<span class=\"token punctuation\">.</span>delete<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"注销成功\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"密码错误\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>检查密码是否正确，若正确则注销用户</p>\n<ol start=\"3\">\n<li>【改】完成订单</li>\n</ol>\n<p>以完成订单为例</p>\n<p>前端发送post请求\nURL: <code class=\"language-text\">http://delivery.mcatk.com/api/finishOrder/</code>\nPARA: <code class=\"language-text\">orderID</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">finish_order</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">:</span>\n        data_json <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span>\n        order_id <span class=\"token operator\">=</span> data_json<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"orderID\"</span><span class=\"token punctuation\">)</span>\n        Order<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>order_id<span class=\"token operator\">=</span>order_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>order_completed<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n                             <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"配送完成\"</span><span class=\"token punctuation\">,</span>\n                             <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"请求异常\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"4\">\n<li>用户信息查询</li>\n</ol>\n<p>用前端向后端发送获取用户全部信息的API为例</p>\n<p>前端发送post请求\nURL: <code class=\"language-text\">http://delivery.mcatk.com/api/getInformation/</code>\nPARA: <code class=\"language-text\">userID</code></p>\n<p>后端接到请求，执行<code class=\"language-text\">get_information</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_information</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  \n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">:</span>  \n        data_json <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span>  \n        user_id <span class=\"token operator\">=</span> data_json<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"userID\"</span><span class=\"token punctuation\">)</span>  \n        user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>user_id<span class=\"token operator\">=</span>user_id<span class=\"token punctuation\">)</span>  \n        orders1 <span class=\"token operator\">=</span> get_orders<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>  \n        orders2 <span class=\"token operator\">=</span> get_orders<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>  \n        stars <span class=\"token operator\">=</span> get_stars<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>  \n        <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>  \n\t\t\t\t\t\t\t <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"查询成功\"</span><span class=\"token punctuation\">,</span>  \n\t\t\t\t\t\t\t <span class=\"token string\">\"userName\"</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>user_name<span class=\"token punctuation\">,</span>  \n\t\t\t\t\t\t\t <span class=\"token string\">\"userNickName\"</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>user_nickname<span class=\"token punctuation\">,</span>  \n\t\t\t\t\t\t\t <span class=\"token string\">\"userAddress\"</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>user_address<span class=\"token punctuation\">,</span>  \n\t\t\t\t\t\t\t <span class=\"token string\">\"userTel\"</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>user_tel<span class=\"token punctuation\">,</span>  \n\t\t\t\t\t\t\t <span class=\"token string\">\"userOrders\"</span><span class=\"token punctuation\">:</span> orders1<span class=\"token punctuation\">,</span>  \n\t\t\t\t\t\t\t <span class=\"token string\">\"userDeliveryOrders\"</span><span class=\"token punctuation\">:</span> orders2<span class=\"token punctuation\">,</span>  \n\t\t\t\t\t\t\t <span class=\"token string\">\"userStars\"</span><span class=\"token punctuation\">:</span> stars<span class=\"token punctuation\">,</span>  \n\t\t\t\t\t\t\t <span class=\"token string\">\"userIconUrl\"</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>user_icon_url<span class=\"token punctuation\">,</span>  \n\t\t\t\t\t\t\t <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  \n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>  \n        JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"请求异常\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>此过程还会调用获取用户订单和用户收藏以及机器学习的函数，不具体展出</p>\n<p>随后，前端可以得到类似如下的返回</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n<span class=\"token property\">\"success\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"查询成功\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"userName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"zzh\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"userNickName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"粥童帆\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"userAddress\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"学院路-15公寓\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"userTel\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"18800130501\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"userOrders\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n...\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这样我们就完成了前后端的通信</p>\n<h2 id=\"密码加密\" style=\"position:relative;\"><a href=\"#%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86\" aria-label=\"密码加密 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>密码加密</h2>\n<p>我们对数据库的密码进行了加密，通过Django的 <code class=\"language-text\">make_password()</code> 和 <code class=\"language-text\">check_password()</code> 函数在传入和验证密码时候进行了加密解密操作。</p>\n<p><img src=\"https://pic.mcac.cc/soto-pictures/2021-12/lZOUAk.png\" alt=\"数据库中加密的密码\"></p>\n<p>同时，由于我们的系统起初上线时密码为明文存储，我们会在老用户第一次登陆时通过其验证并为其加密。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">if</span> user<span class=\"token punctuation\">.</span>user_password <span class=\"token operator\">==</span> password<span class=\"token punctuation\">:</span>  \n    user<span class=\"token punctuation\">.</span>user_password <span class=\"token operator\">=</span> make_password<span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span>  \n    user<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n    <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"登录成功，已为您的密码加密\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"userID\"</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>user_id<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  \n<span class=\"token keyword\">elif</span> check_password<span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span>user_password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  \n    <span class=\"token keyword\">return</span> JsonResponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"登录成功\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"userID\"</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>user_id<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"设计细节\" style=\"position:relative;\"><a href=\"#%E8%AE%BE%E8%AE%A1%E7%BB%86%E8%8A%82\" aria-label=\"设计细节 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>设计细节</h2>\n<h3 id=\"热菜推荐\" style=\"position:relative;\"><a href=\"#%E7%83%AD%E8%8F%9C%E6%8E%A8%E8%8D%90\" aria-label=\"热菜推荐 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>热菜推荐</h3>\n<p>我们通过MySQL的特性，统计出在订单-菜品关系表中出现最多的菜品，向用户推荐热门菜品。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">order_foods <span class=\"token operator\">=</span> OrderFood<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span><span class=\"token string\">'food_id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>annotate<span class=\"token punctuation\">(</span><span class=\"token builtin\">sum</span><span class=\"token operator\">=</span>Sum<span class=\"token punctuation\">(</span><span class=\"token string\">'food_num'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>order_by<span class=\"token punctuation\">(</span><span class=\"token string\">'-sum'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> order_food <span class=\"token keyword\">in</span> order_foods<span class=\"token punctuation\">:</span>  \n    food <span class=\"token operator\">=</span> Food<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>food_id<span class=\"token operator\">=</span>order_food<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'food_id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  \n    food_json <span class=\"token operator\">=</span> get_food_json<span class=\"token punctuation\">(</span>food<span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>  \n    food_json<span class=\"token punctuation\">[</span><span class=\"token string\">\"sum\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> order_food<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'sum'</span><span class=\"token punctuation\">)</span>  \n    food_list<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>food_json<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"按时间展示\" style=\"position:relative;\"><a href=\"#%E6%8C%89%E6%97%B6%E9%97%B4%E5%B1%95%E7%A4%BA\" aria-label=\"按时间展示 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>按时间展示</h3>\n<p>我们在展示订单，评论等时候会按照时间先后展示，更加人性化</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">food_evaluates <span class=\"token operator\">=</span> FoodEvaluate<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>food_id<span class=\"token operator\">=</span>food_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>order_by<span class=\"token punctuation\">(</span><span class=\"token string\">\"-food_evaluate_date\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"下单送单\" style=\"position:relative;\"><a href=\"#%E4%B8%8B%E5%8D%95%E9%80%81%E5%8D%95\" aria-label=\"下单送单 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>下单&#x26;送单</h3>\n<p>由于我们的开发APP的初衷就是任何用户都可以下单，也可以送单，因此我们提供了返回自己下的单和自己接的单，还有等待接的单的API，他们都根据你的角色不同，返回不同的的结构类型，例如，当你查看自己的单，数据重点在于你点的菜品和价格等，而当你查看你可以接的单时，数据的重点在于这个订单是从哪里送到哪里等等，为此我们提供了各式各样的查询API。</p>\n<h2 id=\"数据完整性\" style=\"position:relative;\"><a href=\"#%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7\" aria-label=\"数据完整性 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>数据完整性</h2>\n<p>我们为所有存在关系的对象增加了外键约束，并且加入了 MySQL  <code class=\"language-text\">on delete cascade</code> 的删除规则，在对象删除时删除与其有外键约束的对象。</p>\n<p>例如，当我们删除一个用户的时候，他的全部订单，订单中的菜品关系，用户收藏等将被一并删除，不会出现数据异常。</p>","frontmatter":{"title":"TakeawayDelivery 后端实现","date":"2021-12-07","description":null,"image":"https://pic.mcac.cc/soto/202112170131240.png","tags":["Project"]}}},"pageContext":{"id":"88cd875a-3cf1-5134-b80d-92b901cf3ba5"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}