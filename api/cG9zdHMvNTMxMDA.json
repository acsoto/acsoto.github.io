{"title":"Memo","date":"2021-10-28T09:29:00.000Z","date_formatted":{"ll":"2021年10月28日","L":"2021/10/28","MM-DD":"10-28"},"thumbnail":"https://tva1.sinaimg.cn/large/008i3skNly1gwv08ty64aj31340m4761.jpg","link":"posts/53100","tags":["Swift","开发","项目"],"updated":"2021-12-01T08:36:46.501Z","content":"<h1 id=\"memo\">Memo<a title=\"#memo\" href=\"#memo\"></a></h1>\n<p>Memo用于随时记录，记录生活中的某一刻，记录今天的心情，或是记录看过的一部电影，一本书，留下自己此时的感想，并在自己最爱的电影或书籍的二刷三刷后再次记录下时间和新的想法…</p>\n<p>灵感来源于豆瓣，比起豆瓣的功能多出的个人需求为：需要一个简洁没有过量冗余信息的片单和书单记录软件，记录二刷，三刷的时间，以及想要随时记录每一天，并且在几年后回顾那年今日，留一些感动与感慨，让每一天都值得被纪念，故开发此软件。</p>\n<h2 id=\"图片\">图片<a title=\"#图片\" href=\"#图片\"></a></h2>\n<p><img src=\"/posts/53100/image-20211120173053786.png\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>（介绍及短评摘自豆瓣，侵删）</p>\n<p><img src=\"/posts/53100/008i3skNly1gwlr5i3osjj30u010ujtt.jpg\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p>Mac, iPad适配</p>\n<h2 id=\"简介\">简介<a title=\"#简介\" href=\"#简介\"></a></h2>\n<h3 id=\"主页面\">主页面<a title=\"#主页面\" href=\"#主页面\"></a></h3>\n<p>主界面分为3个标签：主页，电影，书籍</p>\n<h5 id=\"主页\">主页<a title=\"#主页\" href=\"#主页\"></a></h5>\n<p><img src=\"/posts/53100/008i3skNly1gwlqj9g2ltj30pi0tkq5a.jpg\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"/posts/53100/008i3skNly1gwlqj9pbc4j30pk0vowg3.jpg\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h5 id=\"电影\">电影<a title=\"#电影\" href=\"#电影\"></a></h5>\n<p>这里是你看过的电影片单，你可以随时看到你标记过的所有电影，以及在任何时候添加一个新的电影进入你的片单</p>\n<p>进入某条电影，如果你输入的电影在数据库之中（数据来自豆瓣，侵删），你就可以看到关于电影的介绍：演员，导演，豆瓣评分，类别，介绍等，以及最重要的，在最下方，看到你第一次观看的时间以及感想</p>\n<p>当然，点击此方框，你可以进入到第二次标记的页面，记录下你的第二次观影以及新的感想</p>\n<p><img src=\"/posts/53100/008i3skNly1gwlr3yyccmj30u00yfdi5.jpg\" alt loading=\"lazy\" class=\"φbp\"></p>\n<p><img src=\"/posts/53100/008i3skNly1gwuznrfz7oj30u00xmju5.jpg\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h5 id=\"书籍\">书籍<a title=\"#书籍\" href=\"#书籍\"></a></h5>\n<p>类似电影，这里是你的书单，你可以添加你看过的书籍，并且记录第n次阅读的体验，相信每一次阅读，都会发现不少新东西</p>\n<p><img src=\"/posts/53100/008i3skNly1gwlr1ixi5pj30u010gmys.jpg\" alt loading=\"lazy\" class=\"φbp\"></p>\n<h2 id=\"功能\">功能<a title=\"#功能\" href=\"#功能\"></a></h2>\n<ul>\n<li>标记某一天的感受</li>\n<li>标记某本电影，某本书</li>\n<li>多次标记某电影和书的观看时间和感受</li>\n<li>自动展示电影和书籍的相关图片与简介</li>\n<li>图文并茂的主页卡片展示设计</li>\n<li>在主页展示进一个月看过的电影</li>\n<li>在主页展示今天以及那年今日的感想</li>\n</ul>\n<h2 id=\"架构以及实现\">架构以及实现<a title=\"#架构以及实现\" href=\"#架构以及实现\"></a></h2>\n<p>源代码文件共25个</p>\n<p>主要分为三个部分：Controller Model Views</p>\n<p><img src=\"/posts/53100/008i3skNly1gwuz8sdizwj306r0kx3z9.jpg\" alt=\"image-20211027232454144\" loading=\"lazy\" class=\"φbp\"></p>\n<h4 id=\"controller\">Controller<a title=\"#controller\" href=\"#controller\"></a></h4>\n<p>一些静态函数，实现点击界面按钮后的某些后端反应以及后端用到的函数，如图像获取，日期格式化，Mark筛选等</p>\n<p>其中图片的读取使用了异步加载url的方式，如果url没有解析成功将不会显示图片</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ImageLoader</span>: <span class=\"title\">ObservableObject</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> didChange <span class=\"operator\">=</span> <span class=\"type\">PassthroughSubject</span>&lt;<span class=\"type\">Data</span>, <span class=\"type\">Never</span>&gt;()</span><br><span class=\"line\">    <span class=\"keyword\">var</span> data <span class=\"operator\">=</span> <span class=\"type\">Data</span>() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">didSet</span> &#123;</span><br><span class=\"line\">            didChange.send(data)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">urlString</span>: <span class=\"type\">String</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> url <span class=\"operator\">=</span> <span class=\"type\">URL</span>(string: urlString) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> task <span class=\"operator\">=</span> <span class=\"type\">URLSession</span>.shared.dataTask(with: url) &#123; (data, response, error) <span class=\"keyword\">in</span></span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> data <span class=\"operator\">=</span> data <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"type\">DispatchQueue</span>.main.async &#123;</span><br><span class=\"line\">                <span class=\"keyword\">self</span>.data <span class=\"operator\">=</span> data</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        task.resume()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"model\">Model<a title=\"#model\" href=\"#model\"></a></h4>\n<p>主要用到的对象为Mark：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mark</span>: <span class=\"title\">Codable</span>, <span class=\"title\">Identifiable</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> index:<span class=\"type\">Int</span> <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> type:<span class=\"type\">ModelType</span> <span class=\"operator\">=</span> <span class=\"type\">ModelType</span>.<span class=\"type\">NONE</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> name <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> dates: [<span class=\"type\">Date</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">    <span class=\"keyword\">var</span> feeling <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">index</span>: <span class=\"type\">Int</span>,<span class=\"params\">type</span>:<span class=\"type\">ModelType</span>, <span class=\"params\">name</span>:<span class=\"type\">String</span>, <span class=\"params\">date</span>:<span class=\"type\">Date</span>, <span class=\"params\">feeling</span>:<span class=\"type\">String</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.index <span class=\"operator\">=</span> index</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.type <span class=\"operator\">=</span> type</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.name <span class=\"operator\">=</span> name</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.dates.append(date)</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.feeling <span class=\"operator\">=</span> feeling</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Movie, Book 为电影和书籍的简介，不进行重复的展示</p>\n<p>他们遵循MarkableObject协议，用于在展示Mark详情时读取object后再作类型判断</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Movie</span>: <span class=\"title\">Hashable</span>, <span class=\"title\">Codable</span>, <span class=\"title\">Identifiable</span>, <span class=\"title\">MarkableObject</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> id: <span class=\"type\">String</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t<span class=\"operator\">...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ModelData负责数据存储的任务</p>\n<p>用到了自带的UserDefaults.standard存储数据</p>\n<p>movies和books分别为电影和书籍数据集，内置在app中</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ModelData</span>: <span class=\"title\">ObservableObject</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> moviesDict <span class=\"operator\">=</span> getMoviesDict(movies: load(<span class=\"string\">&quot;movies.json&quot;</span>))</span><br><span class=\"line\">    <span class=\"keyword\">var</span> booksDict <span class=\"operator\">=</span> getBooksDict(books: load(<span class=\"string\">&quot;books.json&quot;</span>))</span><br><span class=\"line\">    <span class=\"meta\">@Published</span> <span class=\"keyword\">var</span> marks: [<span class=\"type\">Mark</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">init</span>()</span> &#123;</span><br><span class=\"line\">        loadMarks()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">loadMarks</span>()</span> &#123;</span><br><span class=\"line\">        marks <span class=\"operator\">=</span> <span class=\"type\">UserDefaults</span>.standard.object(([<span class=\"type\">Mark</span>]).<span class=\"keyword\">self</span>, with: <span class=\"string\">&quot;Marks&quot;</span>) <span class=\"operator\">??</span> []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">saveMarks</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> standard <span class=\"operator\">=</span> <span class=\"type\">UserDefaults</span>.standard</span><br><span class=\"line\">        standard.set(object: marks, forKey: <span class=\"string\">&quot;Marks&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ModelType为枚举类型，用于Mark类型判断</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">ModelType</span>: <span class=\"title\">String</span>, <span class=\"title\">Codable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"type\">NONE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;无&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"type\">MOVIE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;电影&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"type\">BOOK</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;书籍&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"type\">DAY</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;今天&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"views\">Views<a title=\"#views\" href=\"#views\"></a></h4>\n<p>界面UI</p>\n<p>用到了environmentObject来同步各个界面的数据</p>\n<p>父界面给子界面传递@Binding的变量，子界面拿到引用直接演示和修改，不会出现数据不同步的问题</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@main</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">MemoApp</span>: <span class=\"title\">App</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@StateObject</span> <span class=\"keyword\">private</span> <span class=\"keyword\">var</span> modelData <span class=\"operator\">=</span> <span class=\"type\">ModelData</span>()</span><br><span class=\"line\">    <span class=\"keyword\">var</span> body: <span class=\"keyword\">some</span> <span class=\"type\">Scene</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">WindowGroup</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">ContentView</span>()</span><br><span class=\"line\">                    .environmentObject(modelData)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"mainmenu\">MainMenu<a title=\"#mainmenu\" href=\"#mainmenu\"></a></h5>\n<p>MarkList: Mark列表，即展示电影和书籍列表</p>\n<p>使用NavigationLink，向子界面：MarkDetail传递mark的引用</p>\n<p><img src=\"/posts/53100/image-20211027234131178.png\" alt=\"image-20211027234131178\" loading=\"lazy\" class=\"φbp\"></p>\n<p>HomeView: 主界面</p>\n<h5 id=\"mark\">Mark<a title=\"#mark\" href=\"#mark\"></a></h5>\n<p>关于Mark的界面</p>\n<p>MarkDetail: 一个Mark的详情</p>\n<p>大部分子界面都如此UI一样，引入modelData的环境变量，承接上一级传下来的@Binding变量，实现数据的同步</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@EnvironmentObject</span> <span class=\"keyword\">var</span> modelData: <span class=\"type\">ModelData</span></span><br><span class=\"line\"><span class=\"meta\">@Binding</span> <span class=\"keyword\">var</span> mark: <span class=\"type\">Mark</span></span><br></pre></td></tr></table></figure>\n<p>其中要进行object的解析，如果用户输入能索引本地数据集的一个条目上，将会展示此object的详情</p>\n<p><img src=\"/posts/53100/image-20211027234003022.png\" alt=\"image-20211027234003022\" loading=\"lazy\" class=\"φbp\"></p>\n<p>MarkAdd: Mark增加界面</p>\n<p>MarkEdit: Mark修改界面</p>\n<p>MarkToday: 标记今天界面</p>\n<p>这三个UI都用到了@State来实时同步Form表单中的信息</p>\n<p>以至于用户输入能够及时的反应在变量上并且写入modelData</p>\n<p><img src=\"/posts/53100/image-20211027234224510.png\" alt=\"image-20211027234224510\" loading=\"lazy\" class=\"φbp\"></p>\n<h4 id=\"kit\">Kit<a title=\"#kit\" href=\"#kit\"></a></h4>\n<p>其他组件</p>\n<p><img src=\"/posts/53100/image-20211027234350311.png\" alt=\"image-20211027234350311\" loading=\"lazy\" class=\"φbp\"></p>\n<p>电影和书籍详情，时间线，圆形和方形图片，卡片组件等</p>\n<p>均已展示在各个页面中</p>\n<h4 id><a title=\"#\" href=\"#\"></a></h4>\n","prev":{"title":"2021年11月的第一场雪","link":"posts/11219"},"next":{"title":"Maven","link":"posts/38008"},"plink":"http://atksoto.com/posts/53100/","toc":[{"id":"memo","title":"Memo","index":"1","children":[{"id":"图片","title":"图片","index":"1.1"},{"id":"简介","title":"简介","index":"1.2","children":[{"id":"主页面","title":"主页面","index":"1.2.1"}]},{"id":"功能","title":"功能","index":"1.3"},{"id":"架构以及实现","title":"架构以及实现","index":"1.4"}]}],"copyright":{"author":"soto","link":"<a href=\"http://atksoto.com/posts/53100/\" title=\"Memo\">http://atksoto.com/posts/53100/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"},"reading_time":"1366 字约 9 分钟"}