<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Lexical analysis Before Code Requriement: read testfile.txt, parse every char to word and print them. At the same time, memorize type, content and line number of each word. File reading Read by line, scan every char of every string and analyse. 1 2 3 while ((s = bf.readLine()) != null) { ... } Analyse When i get the key word, enter the next analyst. 1 2 3 4 5 6'><title>Alxa_Compiler(SysY to PCODE)</title>

<link rel='canonical' href='https://childsail.com/alxa_compilersysy-to-pcode/'>

<link rel="stylesheet" href="/scss/style.min.450926226e724574a6b936335ea06111f8aeb253d932c86cb2cc807341cd2889.css"><meta property='og:title' content='Alxa_Compiler(SysY to PCODE)'>
<meta property='og:description' content='Lexical analysis Before Code Requriement: read testfile.txt, parse every char to word and print them. At the same time, memorize type, content and line number of each word. File reading Read by line, scan every char of every string and analyse. 1 2 3 while ((s = bf.readLine()) != null) { ... } Analyse When i get the key word, enter the next analyst. 1 2 3 4 5 6'>
<meta property='og:url' content='https://childsail.com/alxa_compilersysy-to-pcode/'>
<meta property='og:site_name' content='SOTO-BLOG'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='BUAA' /><meta property='article:tag' content='编译' /><meta property='article:tag' content='项目' /><meta property='article:tag' content='Java' /><meta property='article:published_time' content='2021-11-16T16:29:00&#43;08:00'/><meta property='article:modified_time' content='2022-03-27T01:25:58&#43;08:00'/><meta property='og:image' content='https://tva1.sinaimg.cn/large/008i3skNly1gwuyxmimj1j30tg0c0wfl.jpg' />
<meta name="twitter:site" content="@childsail">
    <meta name="twitter:creator" content="@childsail"><meta name="twitter:title" content="Alxa_Compiler(SysY to PCODE)">
<meta name="twitter:description" content="Lexical analysis Before Code Requriement: read testfile.txt, parse every char to word and print them. At the same time, memorize type, content and line number of each word. File reading Read by line, scan every char of every string and analyse. 1 2 3 while ((s = bf.readLine()) != null) { ... } Analyse When i get the key word, enter the next analyst. 1 2 3 4 5 6"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://tva1.sinaimg.cn/large/008i3skNly1gwuyxmimj1j30tg0c0wfl.jpg' />
    <link rel="shortcut icon" href="http://pic.mcatk.com/soto-pictures/2021-12/PEqcQi.jpeg" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    <img src="http://pic.mcatk.com/soto-pictures/2021-12/PEqcQi.jpeg" width="300" height="300" class="site-logo" loading="lazy" alt="Avatar">
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">SOTO-BLOG</a></h1>
            <h2 class="site-description">多喝热水</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/acsoto'
                        target="_blank"
                        title="GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://space.bilibili.com/85122707'
                        target="_blank"
                        title="bilibili"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="icon" width="200px" height="200.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M306.005333 117.632L444.330667 256h135.296l138.368-138.325333a42.666667 42.666667 0 0 1 60.373333 60.373333L700.330667 256H789.333333A149.333333 149.333333 0 0 1 938.666667 405.333333v341.333334a149.333333 149.333333 0 0 1-149.333334 149.333333h-554.666666A149.333333 149.333333 0 0 1 85.333333 746.666667v-341.333334A149.333333 149.333333 0 0 1 234.666667 256h88.96L245.632 177.962667a42.666667 42.666667 0 0 1 60.373333-60.373334zM789.333333 341.333333h-554.666666a64 64 0 0 0-63.701334 57.856L170.666667 405.333333v341.333334a64 64 0 0 0 57.856 63.701333L234.666667 810.666667h554.666666a64 64 0 0 0 63.701334-57.856L853.333333 746.666667v-341.333334A64 64 0 0 0 789.333333 341.333333zM341.333333 469.333333a42.666667 42.666667 0 0 1 42.666667 42.666667v85.333333a42.666667 42.666667 0 0 1-85.333333 0v-85.333333a42.666667 42.666667 0 0 1 42.666666-42.666667z m341.333334 0a42.666667 42.666667 0 0 1 42.666666 42.666667v85.333333a42.666667 42.666667 0 0 1-85.333333 0v-85.333333a42.666667 42.666667 0 0 1 42.666667-42.666667z" fill="#bfbfbf" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/childsail'
                        target="_blank"
                        title="Twitter"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.mcac.cc'
                        target="_blank"
                        title="mc"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="icon" width="200px" height="200.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M170.666667 85.333333h682.666666a85.333333 85.333333 0 0 1 85.333334 85.333334v682.666666a85.333333 85.333333 0 0 1-85.333334 85.333334H170.666667a85.333333 85.333333 0 0 1-85.333334-85.333334V170.666667a85.333333 85.333333 0 0 1 85.333334-85.333334m85.333333 170.666667v170.666667h170.666667v85.333333H341.333333v256h85.333334v-85.333333h170.666666v85.333333h85.333334v-256h-85.333334v-85.333333h170.666667V256h-170.666667v170.666667h-170.666666V256H256z" fill="#bfbfbf" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='/index.xml'
                        target="_blank"
                        title="Rss"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="5" cy="19" r="1" />
  <path d="M4 4a16 16 0 0 1 16 16" />
  <path d="M4 11a9 9 0 0 1 9 9" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        

        <li >
            <a href='/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>链接</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://childsail.com/" selected>中文</option>
                        
                            <option value="https://childsail.com/en/" >English</option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>暗色模式</span>
                </li>
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/alxa_compilersysy-to-pcode/">
                
                    <img src="https://tva1.sinaimg.cn/large/008i3skNly1gwuyxmimj1j30tg0c0wfl.jpg" loading="lazy" alt="Featured image of post Alxa_Compiler(SysY to PCODE)" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/coding/" >
                Coding
            </a>
        
            <a href="/categories/buaa/" >
                BUAA
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/alxa_compilersysy-to-pcode/">Alxa_Compiler(SysY to PCODE)</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Nov 16, 2021</time>
            </div>
        

        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <h2 id="lexical-analysis">Lexical analysis</h2>
<h3 id="before-code">Before Code</h3>
<p>Requriement:  read <code>testfile.txt</code>, parse every char to word and print them. At the same time, memorize type, content and line number of  each word.</p>
<h4 id="file-reading">File reading</h4>
<p>Read by line, scan every char of every string and analyse.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">while</span> <span class="o">((</span><span class="n">s</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="analyse">Analyse</h4>
<p>When i get the key word, enter the next analyst.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">while</span> <span class="o">((</span><span class="n">c</span> <span class="o">=</span> <span class="n">getChar</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\r&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\t&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">continue</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;%&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">words</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Word</span><span class="o">(</span><span class="n">c</span><span class="o">));</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">analyseSlash</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;(&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;)&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;[&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;]&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;{&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;}&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">words</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Word</span><span class="o">(</span><span class="n">c</span><span class="o">));</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;&gt;&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;&lt;&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;=&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;!&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">analyseRelation</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;,&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;;&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">words</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Word</span><span class="o">(</span><span class="n">c</span><span class="o">));</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;&#34;&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">analyseCitation</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;&amp;&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;|&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">analyseLogic</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">Character</span><span class="o">.</span><span class="na">isDigit</span><span class="o">(</span><span class="n">c</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">analyseDigit</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">Character</span><span class="o">.</span><span class="na">isLetter</span><span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;_&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">analyseLetter</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="common">Common</h5>
<p>For example, when I get &lsquo;+&rsquo;, I directly new a Word typify the &ldquo;PLUS&rdquo;.</p>
<h5 id="function">Function</h5>
<p>For example</p>
<p>When I get <code>&lt;</code> , enter function<code>analyseRelation</code> read one char more. If it is<code>=</code>, analyze <code>LEQ</code>&hellip;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;&lt;&#39;</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">getChar</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;=&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">words</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Word</span><span class="o">(</span><span class="s">&#34;&lt;=&#34;</span><span class="o">));</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">unGetChar</span><span class="o">();</span>
    <span class="n">words</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Word</span><span class="o">(</span><span class="s">&#34;&lt;&#34;</span><span class="o">));</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>analyseLogic</code> is as the same.</p>
<h5 id="digit-and-letter">Digit and Letter</h5>
<p>Digit: When I get a digit, it means I will scan a serial of some digits and turn them into a Word typify &ldquo;INTCON&rdquo;.</p>
<p>Letter: When I get a letter, it means I will scan a string about letter or digit. It maybe a &ldquo;IDENFR&rdquo; or &ldquo;STRCON&rdquo;, which depends on whether it is in key map or not.</p>
<h4 id="word">Word</h4>
<p>class Word:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Word</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">identification</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">type</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Capsulate the initial function, I only need to <code>new Word(...)</code> in the main processor, which will create the corresponding word.</p>
<p>For example</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">public</span> <span class="nf">Word</span><span class="o">(</span><span class="kt">char</span> <span class="n">identification</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">identification</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">identification</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="k">new</span> <span class="n">KeyWordMap</span><span class="o">().</span><span class="na">getType</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">identification</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">identification</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As for KeyWordMap, it is a HashMap, mapping the string of word and its type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">public</span> <span class="nf">KeyWordMap</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">keyWords</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">keyWords</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;main&#34;</span><span class="o">,</span> <span class="s">&#34;MAINTK&#34;</span><span class="o">);</span>
        <span class="n">keyWords</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;const&#34;</span><span class="o">,</span> <span class="s">&#34;CONSTTK&#34;</span><span class="o">);</span>
        <span class="n">keyWords</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;int&#34;</span><span class="o">,</span> <span class="s">&#34;INTTK&#34;</span><span class="o">);</span>
        <span class="o">...</span>
        <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="after-code">After Code</h3>
<h4 id="file-reading-1">File reading</h4>
<p>Read file by line is not convenient for preread and undo, so I read the file into a single String at first.</p>
<p>The method is read by line, add <code>\n</code> after every line and scan every char. When I get <code>\n</code>, <code>lineNum++</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="n">String</span> <span class="nf">transferFileToCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">BufferedReader</span> <span class="n">bf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">reader</span><span class="o">);</span>
        <span class="n">StringBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">((</span><span class="n">s</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">s</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;\n&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">buffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="analyse-1">Analyse</h4>
<p>About analyst, it is different from what before coding.</p>
<p>First, I need analyze word one by one, so I add global variety <code>index</code> to memorize where is the pointer.</p>
<p>Besides, I met the situation that I need read one more or undo, so I  encapsulate the function <code>ungetChar</code> and <code>getChar</code>, which will be convenient for me to analyze.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="n">Character</span> <span class="nf">getChar</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">code</span><span class="o">.</span><span class="na">length</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">lineNum</span><span class="o">++;</span>
            <span class="o">}</span>
            <span class="n">index</span><span class="o">++;</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">unGetChar</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">index</span><span class="o">--;</span>
        <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">lineNum</span><span class="o">--;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="slash">Slash</h5>
<ol>
<li><code>//</code> : When it comes to <code>\n</code> , stop.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">do</span> <span class="o">{</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">getChar</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span><span class="o">;</span>
    <span class="c1">// 判断为//注释，结束分析
</span><span class="c1"></span>  <span class="o">}</span>
<span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li><code>/* */</code>: Get char until <code>*/</code> appears</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">do</span> <span class="o">{</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">getChar</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">getChar</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span><span class="o">;</span>
      <span class="c1">// 判断为/* */注释，直接结束分析
</span><span class="c1"></span>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">unGetChar</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="grammatical-analysis">Grammatical analysis</h2>
<p>Requirement: Based on the words identified by the lexical analysis program, identify various grammatical elements according to the grammatical rules. Recursive descent method is used to analyze the grammatical components defined in the grammar.</p>
<h3 id="before-code-1">Before Code</h3>
<h4 id="data-reading">Data Reading</h4>
<p>Like the lexical analyst, I prepared function  <code>getWord</code> <code>getNextWord</code> and so on. At the same time, there is a global variety <code>(Word) curWord</code> to display which word it is when I read <code>ArrayList&lt;Word&gt; words </code> from lexical analyst one by one.</p>
<p>My analyst tragedy is as follows:</p>
<p>To normal rule: I keep getting words and analyze them</p>
<p>To expression rule: I scan the whole expression first, which is implemented by function <code>getExp</code>. Then I divide the expression and use method recursive descent to analyze them.</p>
<p><code>getExp</code> like</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="nf">getExp</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">exp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">word</span> <span class="n">is</span> <span class="n">symbol</span> <span class="n">of</span> <span class="n">end</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="o">...</span>
            <span class="n">getWordWithoutAddToGrammar</span><span class="o">();</span>
            <span class="n">exp</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">curWord</span><span class="o">);</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">getNextWord</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">exp</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="recursive-descent">recursive descent</h4>
<p>According to Grammatical Rules, code function for every term of rule.</p>
<p>Main idea: read a word, check what it symbolize and enter the next analyzing function.</p>
<p>For example:</p>
<p>to</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">CompUnit</span> <span class="err">→</span> <span class="p">{</span><span class="n">Decl</span><span class="p">}</span> <span class="p">{</span><span class="n">FuncDef</span><span class="p">}</span> <span class="n">MainFuncDef</span> <span class="c1">// 1.是否存在Decl 2.是否存在 FuncDef
</span></code></pre></td></tr></table>
</div>
</div><p>I analyze like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">analyseCompUnit</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">Word</span> <span class="n">word</span> <span class="o">=</span> <span class="n">getNextWord</span><span class="o">();</span>
  <span class="k">while</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;CONSTTK&#34;</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span>
    <span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;INTTK&#34;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">getNext2Word</span><span class="o">().</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;IDENFR&#34;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">getNext3Word</span><span class="o">().</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;LPARENT&#34;</span><span class="o">)))</span> <span class="o">{</span>
    <span class="n">analyseDecl</span><span class="o">();</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getNextWord</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="k">while</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;VOIDTK&#34;</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span>
    <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;INTTK&#34;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">getNext2Word</span><span class="o">().</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;MAINTK&#34;</span><span class="o">))))</span> <span class="o">{</span>
    <span class="n">analyseFuncDef</span><span class="o">();</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">getNextWord</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;INTTK&#34;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">getNext2Word</span><span class="o">().</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;MAINTK&#34;</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">analyseMainFuncDef</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">error</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="n">grammar</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;&lt;CompUnit&gt;&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>grammar is used for memorize output of lexical analyst and grammar analyst list.</p>
<h4 id="left-recursion">left recursion</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">加减表达式</span> <span class="n">AddExp</span> <span class="err">→</span> <span class="n">MulExp</span> <span class="o">|</span> <span class="n">AddExp</span> <span class="o">(</span><span class="sc">&#39;+&#39;</span> <span class="o">|</span> <span class="sc">&#39;−&#39;</span><span class="o">)</span> <span class="n">MulExp</span> <span class="c1">// 1.MulExp 2.+ 需覆盖 3.- 需覆盖
</span></code></pre></td></tr></table>
</div>
</div><p>Check if the exp has &lsquo;+&rsquo; or &lsquo;-&rsquo;. If it has, separate the exp to AddExp and  MulExp. Then analyze them separately.</p>
<h3 id="after-code-1">After Code</h3>
<h4 id="left-recursion-1">left recursion</h4>
<p>The method used before is not perfect for recursive descent. So I changed my rewrite way.</p>
<p>to</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="err">加减表达式</span> <span class="n">AddExp</span> <span class="err">→</span> <span class="n">MulExp</span> <span class="o">|</span> <span class="n">AddExp</span> <span class="p">(</span><span class="sc">&#39;+&#39;</span> <span class="o">|</span> <span class="sc">&#39;−&#39;</span><span class="p">)</span> <span class="n">MulExp</span> <span class="c1">// 1.MulExp 2.+ 需覆盖 3.- 需覆盖
</span></code></pre></td></tr></table>
</div>
</div><p>Rewrite it like</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">AddExp</span> <span class="err">→</span> <span class="n">MulExp</span> <span class="p">(</span><span class="sc">&#39;+&#39;</span> <span class="o">|</span> <span class="sc">&#39;−&#39;</span><span class="p">)</span> <span class="n">MulExp</span>  <span class="p">(</span><span class="sc">&#39;+&#39;</span> <span class="o">|</span> <span class="sc">&#39;−&#39;</span><span class="p">)</span> <span class="n">MulExp</span> <span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><p>Code like</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">analyseMulExp</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">exp</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Exps</span> <span class="n">exps</span> <span class="o">=</span> <span class="n">divideExp</span><span class="o">(</span><span class="n">exp</span><span class="o">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;MULT&#34;</span><span class="o">,</span> <span class="s">&#34;DIV&#34;</span><span class="o">,</span> <span class="s">&#34;MOD&#34;</span><span class="o">)));</span>
  <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">exp1</span> <span class="o">:</span> <span class="n">exps</span><span class="o">.</span><span class="na">getWords</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">analyseUnaryExp</span><span class="o">(</span><span class="n">exp1</span><span class="o">);</span>
    <span class="n">grammar</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;&lt;MulExp&gt;&#34;</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">exps</span><span class="o">.</span><span class="na">getSymbols</span><span class="o">().</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">grammar</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">exps</span><span class="o">.</span><span class="na">getSymbols</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">++).</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Function <code>divideExp</code> is used for divide the whole exp passed by <code>getExp</code> or the pre function.</p>
<p><code>divideExp</code>:</p>
<p>In: orignal: <code>exp</code> stop symbol:  <code>symbol</code></p>
<p>Out: List of divided exp and symbol.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="n">Exps</span> <span class="nf">divideExp</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">exp</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">symbol</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;&gt;</span> <span class="n">exps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">exp1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
  <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">symbols</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
  <span class="kt">boolean</span> <span class="n">unaryFlag</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">flag1</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">flag2</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">exp</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">Word</span> <span class="n">word</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;LPARENT&#34;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">flag1</span><span class="o">++;</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;RPARENT&#34;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">flag1</span><span class="o">--;</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;LBRACK&#34;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">flag2</span><span class="o">++;</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;RBRACK&#34;</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">flag2</span><span class="o">--;</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">symbol</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">getType</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="n">flag1</span> <span class="o">==</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="n">flag2</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">//UnaryOp
</span><span class="c1"></span>      <span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeOfUnary</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">unaryFlag</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">exp1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
          <span class="k">continue</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
      <span class="n">exps</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">exp1</span><span class="o">);</span>
      <span class="n">symbols</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
      <span class="n">exp1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">exp1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">unaryFlag</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;IDENFR&#34;</span><span class="o">)</span> <span class="o">||</span> <span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;RPARENT&#34;</span><span class="o">)</span> <span class="o">||</span> <span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;INTCON&#34;</span><span class="o">)</span> <span class="o">||</span> <span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;RBRACK&#34;</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="n">exps</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">exp1</span><span class="o">);</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Exps</span><span class="o">(</span><span class="n">exps</span><span class="o">,</span> <span class="n">symbols</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Exps</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exps</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;&gt;</span> <span class="n">words</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">symbols</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="other-bugs">other bugs</h4>
<p>Most bugs are produced by function <code>getExp</code> and <code>divideExp</code> because of some situations are ignored. So I always get something like index out of range&hellip;</p>
<p>So I changed some symbol of stop getting expression and modify the rules to divide or not the expression and so on.</p>
<h2 id="error-handling">Error handling</h2>
<p>Official errors defination</p>
<p><img src="https://pic.mcatk.com/soto/202112301422547.png"
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="before-code-2">Before Code</h3>
<h4 id="create-the-symbol-table">Create the symbol table</h4>
<p>Symbol class</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Symbol</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">type</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">intType</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">area</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Type means the type of the symbol.</p>
<p>IntType is an integer. If it&rsquo;s 0, the symbol is int. if it&rsquo;s 1, the symbol is int[],  if it&rsquo;s 2, the symbol is int[] []&hellip;</p>
<p>Content is its content.</p>
<p>Area is where is it.</p>
<p>I create a HashMap of Symbols, memorizing symbols created in each area.</p>
<p>When I enter a new area, area++. When I leave an area, area&ndash;, with the corresponding Symbols are destroyed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Symbols</span><span class="o">&gt;</span> <span class="n">symbols</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Function</span><span class="o">&gt;</span> <span class="n">functions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Error</span><span class="o">&gt;</span> <span class="n">errors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">area</span> <span class="o">=</span> <span class="o">-</span><span class="n">1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">needReturn</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">whileFlag</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>needReturn</code> means if the current function need to return.</p>
<p><code>whileFlag </code> means if the current code block is in while circle.</p>
<h4 id="errors">Errors</h4>
<h5 id="a"><strong>a</strong></h5>
<p>Just check format</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFormatIllegal</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">content</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">isLegal</span><span class="o">(</span><span class="n">c</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;%&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">content</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">1</span><span class="o">)</span> <span class="o">==</span> <span class="sc">&#39;d&#39;</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">continue</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\\&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">content</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">1</span><span class="o">)</span> <span class="o">!=</span> <span class="sc">&#39;n&#39;</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isLegal</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>  
    <span class="k">return</span> <span class="n">c</span> <span class="o">==</span> <span class="n">32</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="n">33</span> <span class="o">||</span> <span class="o">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="n">40</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="n">126</span><span class="o">);</span> <span class="c1">//offical defination
</span><span class="c1"></span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="b-c"><strong>b c</strong></h5>
<p>B: Every time I get an identity, check if there is the same symbol has been defined in this area.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">hasSymbolInThisArea</span><span class="o">(</span><span class="n">Word</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">symbols</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">area</span><span class="o">).</span><span class="na">hasSymbol</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
    <span class="o">}</span> 
</code></pre></td></tr></table>
</div>
</div><p>C: Check all area. If the symbol has been defined. Functions are as the same.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">hasSymbol</span><span class="o">(</span><span class="n">Word</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Symbols</span> <span class="n">s</span> <span class="o">:</span> <span class="n">symbols</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">hasSymbol</span><span class="o">(</span><span class="n">word</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="d-e"><strong>d e</strong></h5>
<p>To check if the function parameters are matched, I memorize parameters of every function and when I met a function call, I will scan the function call parameters and match them. I prepare a function to do this. Finally I found I need to use recursive descent again, so I add the check procedure to the recursive descent of the grammatical analyst. Please check the <code>After Code/Error d and e</code></p>
<h5 id="f-g">f g</h5>
<p>There is a global variety <code>needReturn</code> used to display if the current function need return. if it does but there is no return in the end of the code block, or if it doesn&rsquo;t but there is return, the error will be memorized.</p>
<h5 id="h"><strong>h</strong></h5>
<p>Just check if it is a const.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="n">isConst</span><span class="o">(</span><span class="n">word</span><span class="o">))</span> <span class="o">{</span>
  <span class="n">error</span><span class="o">(</span><span class="s">&#34;h&#34;</span><span class="o">,</span> <span class="n">word</span><span class="o">.</span><span class="na">getLineNum</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="i-j-k"><strong>i j k</strong></h5>
<p>Capsulate function about checking missing of the symbol</p>
<p>For example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">checkParent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">getNextWord</span><span class="o">().</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;RPARENT&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">getWord</span><span class="o">();</span><span class="c1">// )
</span><span class="c1"></span>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">error</span><span class="o">(</span><span class="s">&#34;j&#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="l"><strong>l</strong></h5>
<p>Count the number of the parameters of string and printf separately and check if they equal.</p>
<h5 id="m"><strong>m</strong></h5>
<p>There is a global variety <code>whileFlag</code> symbolize if the code block is in while circle. If it isn&rsquo;t, any continue and break will produce error.</p>
<h3 id="after-code-2">After Code</h3>
<h4 id="area">Area</h4>
<p>I mark the area++ when I get a block or a function, but it will lead to the situation that when enter a code block of a function, the parameters of the function can&rsquo;t be memorize in the different are with the block of the function. So I changed the rules to mark area++.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">analyseBlock</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">fromFunc</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">...</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">fromFunc</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">addArea</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="o">...</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Only when the block is not from the function, the area++.</p>
<h4 id="error-d-and-e">Error d and e</h4>
<p>To check if the function parameters are matched, I set an array for every function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Function</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">type</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">returnType</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">paras</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>When I get a function, I memorize its return type and paras.</p>
<p>As for the <code>ArrayList&lt;Integer&gt; paras</code>, it reflects as follows:</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Type</th>
<th>Example</th>
<th>Integer</th>
</tr>
</thead>
<tbody>
<tr>
<td>Void</td>
<td></td>
<td>-1</td>
</tr>
<tr>
<td>Int</td>
<td>a</td>
<td>0</td>
</tr>
<tr>
<td>Int[]</td>
<td>a[]</td>
<td>1</td>
</tr>
<tr>
<td>Int[] []</td>
<td>a[] [3]</td>
<td>2</td>
</tr>
</tbody>
</table></div>
<p>So when I get a function call, I will check the parameter of it with what I have memorized before.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">checkParasMatchRParas</span><span class="o">(</span><span class="n">Word</span> <span class="n">ident</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">paras</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">rparas</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">paras</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">!=</span> <span class="n">rparas</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">error</span><span class="o">(</span><span class="s">&#34;d&#34;</span><span class="o">,</span> <span class="n">ident</span><span class="o">.</span><span class="na">getLineNum</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">paras</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">paras</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">rparas</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)))</span> <span class="o">{</span>
                <span class="n">error</span><span class="o">(</span><span class="s">&#34;e&#34;</span><span class="o">,</span> <span class="n">ident</span><span class="o">.</span><span class="na">getLineNum</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As for getting the parameters real type, I add the analyst procedure to the recursive descent of the grammatical analyst. Just like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">analyseExp</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">exp</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">intType</span> <span class="o">=</span> <span class="n">analyseAddExp</span><span class="o">(</span><span class="n">exp</span><span class="o">);</span>
        <span class="n">grammar</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;&lt;Exp&gt;&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">intType</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Every recursion will return an <code>intType</code>, which symbolize the final type of the expression.</p>
<p>Because the terms of one expression must be the same type, so I return only one of them.</p>
<p>This is the exit of the recursion. It will return a correct type of the expression to the top of the function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java">    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">analyseLVal</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">exp</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">intType</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">...</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;LBRACK&#34;</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">intType</span><span class="o">++;</span>
                    <span class="o">...</span>
                <span class="o">}</span>
         <span class="o">...</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">hasSymbol</span><span class="o">(</span><span class="n">ident</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">getSymbol</span><span class="o">(</span><span class="n">ident</span><span class="o">).</span><span class="na">getIntType</span><span class="o">()</span> <span class="o">-</span> <span class="n">intType</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="code-generation">Code generation</h2>
<p>In this part, I chose to generate Pcode.</p>
<p>I designed a type of Pcode which is an Inverse Bolan expression stack and symbol table based virtual code.</p>
<p>At the same time, I designed virtual machine to execute them.</p>
<p>The Pcode virtual machine is an imaginary machine used to run Pcode commands. It consists of: A code area (code), an instruction pointer (EIP), a stack, a var_table, a func_table and a label_table.</p>
<p>In the following passage, I will introduce how Pcode executes first and how to produce Pcode next.</p>
<h3 id="before-code-3">Before Code</h3>
<h4 id="how-does-the-virtual-machine-run">How does the virtual machine run</h4>
<p>First, we need a <code>codes</code> list and a <code>stack</code>(int).</p>
<p>An <code>eip</code>: presents the address of current running code.</p>
<p>A <code>varTable</code>: memorizes the address of the variety in stack.</p>
<p>A <code>funcTable</code>: memorizes the address of the function in codes list.</p>
<p>A <code>labelTable</code>: Memorizes the address of the label in codes list.</p>
<p>Then, run the code one after another and manage the stack.</p>
<h4 id="how-to-distinguish-different-variety">How to distinguish different variety</h4>
<p>Before generate codes, differentiate varieties from different scopes by its only scope number, like: <code>areaID + &quot;_&quot; + curWord.getContent()</code>. In this situation, the variety will not appear more than once in codes, except for recursive function call, which will be solved by push <code>varTable</code> to stack(show later).</p>
<h4 id="specific-code-definition">Specific Code Definition</h4>
<p>First, define a class for PCode:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PCode</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">CodeType</span> <span class="n">type</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Object</span> <span class="n">value1</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Object</span> <span class="n">value2</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>It presents one code object, which has a CodeType and two operating values. CodeType is an enum. Value1 and value2 maybe Integer or String or null, which depends on specific code type.</p>
<h5 id="calculation-type">Calculation Type</h5>
<p>Two operators:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pop</span><span class="o">();</span>
<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">pop</span><span class="o">();</span>
<span class="n">push</span><span class="o">(</span><span class="n">cal</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><p>Single operator:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">push</span><span class="o">(</span><span class="n">cal</span><span class="o">(</span><span class="n">pop</span><span class="o">()));</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="var">VAR</h5>
<p><strong>VAR</strong> command to declare a variable, save the variable name and the address assigned to it in the variable table.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">case</span> <span class="n">VAR</span><span class="o">:</span> <span class="o">{</span>
    <span class="n">Var</span> <span class="n">var</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Var</span><span class="o">(</span><span class="n">stack</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="n">varTable</span><span class="o">.</span><span class="na">put</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue1</span><span class="o">(),</span> <span class="n">var</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Var.class:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Var</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">dimension</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">dim1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">dim2</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="dimvar">DIMVAR</h5>
<p><strong>DIMVAR</strong> command to declare an array. Set the dimension information of the var.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">case</span> <span class="n">DIMVAR</span><span class="o">:</span> <span class="o">{</span>
    <span class="n">Var</span> <span class="n">var</span> <span class="o">=</span> <span class="n">getVar</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue1</span><span class="o">());</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue2</span><span class="o">();</span>
    <span class="n">var</span><span class="o">.</span><span class="na">setDimension</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pop</span><span class="o">();</span>
        <span class="n">var</span><span class="o">.</span><span class="na">setDim1</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">2</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">pop</span><span class="o">(),</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pop</span><span class="o">();</span>
        <span class="n">var</span><span class="o">.</span><span class="na">setDim1</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="n">var</span><span class="o">.</span><span class="na">setDim2</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="placeholder">PLACEHOLDER</h5>
<p><strong>PLACEHOLDER</strong> command to grow the stack down, allocate the new space to the variety and array.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">case</span> <span class="n">PLACEHOLDER</span><span class="o">:</span> <span class="o">{</span>
    <span class="n">Var</span> <span class="n">var</span> <span class="o">=</span> <span class="n">getVar</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue1</span><span class="o">());</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue2</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">push</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">var</span><span class="o">.</span><span class="na">getDim1</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">push</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">var</span><span class="o">.</span><span class="na">getDim1</span><span class="o">()</span> <span class="o">*</span> <span class="n">var</span><span class="o">.</span><span class="na">getDim2</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">push</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="other">Other</h5>
<p>Calculation type: pop the stack top once or twice, calculate them and push again.</p>
<p>Jump Type: When it&rsquo;s command about jump, just check if the condition is satisfied and change the <code>eip</code>.</p>
<p>Function call: as follows</p>
<h4 id="function-call-procedure">Function call procedure</h4>
<p>First, before function call, there will be some parameters to be pushed into the stack. Each will be followed by a <code>RPARA</code> command, which memorize the address of the previous variety.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">case</span> <span class="n">RPARA</span><span class="o">:</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue1</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">rparas</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">stack</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">rparas</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">stack</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">stack</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Second, function <code>CALL</code>.</p>
<p>Memorize the eip, stack top address, and information about the function(In fact, they will be pushed into stack too). Then update the <code>varTable</code> and <code>eip</code>.  Ready for execute function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">case</span> <span class="n">CALL</span><span class="o">:</span> <span class="o">{</span>
    <span class="n">Func</span> <span class="n">func</span> <span class="o">=</span> <span class="n">funcTable</span><span class="o">.</span><span class="na">get</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue1</span><span class="o">());</span>
    <span class="n">retInfos</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">RetInfo</span><span class="o">(</span><span class="n">eip</span><span class="o">,</span> <span class="n">varTable</span><span class="o">,</span> <span class="n">stack</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">,</span> <span class="n">func</span><span class="o">.</span><span class="na">getArgs</span><span class="o">(),</span> <span class="n">func</span><span class="o">.</span><span class="na">getArgs</span><span class="o">(),</span> <span class="n">nowArgsNum</span><span class="o">));</span>
    <span class="n">eip</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="na">getIndex</span><span class="o">();</span>
    <span class="n">varTable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">callArgsNum</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="na">getArgs</span><span class="o">();</span>
    <span class="n">nowArgsNum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Finally, return when it&rsquo;s <code>RET</code></p>
<p>Restore <code>eip</code>, <code>varTable</code> from <code>RetInfo</code>, clear the new information pushed when function in the stack.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">case</span> <span class="n">RET</span><span class="o">:</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue1</span><span class="o">();</span>
    <span class="n">RetInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="n">retInfos</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">retInfos</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
    <span class="n">eip</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="na">getEip</span><span class="o">();</span>
    <span class="n">varTable</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="na">getVarTable</span><span class="o">();</span>
    <span class="n">callArgsNum</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="na">getCallArgsNum</span><span class="o">();</span>
    <span class="n">nowArgsNum</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="na">getNowArgsNum</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">stack</span><span class="o">.</span><span class="na">subList</span><span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">getStackPtr</span><span class="o">()</span> <span class="o">+</span> <span class="n">1</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="na">getParaNum</span><span class="o">(),</span> <span class="n">stack</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">clear</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">stack</span><span class="o">.</span><span class="na">subList</span><span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">getStackPtr</span><span class="o">()</span> <span class="o">+</span> <span class="n">1</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="na">getParaNum</span><span class="o">(),</span> <span class="n">stack</span><span class="o">.</span><span class="na">size</span><span class="o">()).</span><span class="na">clear</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="value-or-address">Value or Address</h4>
<p>Push value or address of the variety is an important thing, it depends on what I need, which will be presented when I describe how to generate codes.</p>
<p>The command action is as follows(<code>getAddress</code> is used for get the address of the previous variety ).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">case</span> <span class="n">VALUE</span><span class="o">:</span> <span class="o">{</span>
    <span class="n">Var</span> <span class="n">var</span> <span class="o">=</span> <span class="n">getVar</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue1</span><span class="o">());</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue2</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">address</span> <span class="o">=</span> <span class="n">getAddress</span><span class="o">(</span><span class="n">var</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>
    <span class="n">push</span><span class="o">(</span><span class="n">stack</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">address</span><span class="o">));</span>
<span class="o">}</span>
<span class="o">...</span>
<span class="k">case</span> <span class="n">ADDRESS</span><span class="o">:</span> <span class="o">{</span>
    <span class="n">Var</span> <span class="n">var</span> <span class="o">=</span> <span class="n">getVar</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue1</span><span class="o">());</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">code</span><span class="o">.</span><span class="na">getValue2</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">address</span> <span class="o">=</span> <span class="n">getAddress</span><span class="o">(</span><span class="n">var</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>
    <span class="n">push</span><span class="o">(</span><span class="n">address</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="code-generate">Code Generate</h4>
<p>Code generated from the grammatical analyst procedure.</p>
<h5 id="declaration">Declaration</h5>
<p>There is no need to distinguish const and var. When declare a variety, just new a variety and let it point to the stack top. Then if it has an initialization, just push the values one after another. If not, add a <code>PLACEHOLDER</code> command to push something(I push 0) to the stack to hold the place.</p>
<h5 id="assign-sentence">Assign sentence</h5>
<p>In this situation, first calculate and push the address of the variety to the stack top. Then analyze expressions. After that, there are only two number in the stack, which are address and value. Assign the value to the address.</p>
<h5 id="condition-control-sentence">Condition control sentence</h5>
<p>First, generate labels. Then, place jump sentences in the proper places.</p>
<p>labels about if and while will be generated and then stored in a stack type structure. like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">whileLabels</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;());</span>
<span class="n">whileLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;while&#34;</span><span class="o">,</span> <span class="n">labelGenerator</span><span class="o">.</span><span class="na">getLabel</span><span class="o">(</span><span class="s">&#34;while&#34;</span><span class="o">));</span>
<span class="n">whileLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;while_end&#34;</span><span class="o">,</span> <span class="n">labelGenerator</span><span class="o">.</span><span class="na">getLabel</span><span class="o">(</span><span class="s">&#34;while_end&#34;</span><span class="o">));</span>
<span class="n">whileLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;while_block&#34;</span><span class="o">,</span> <span class="n">labelGenerator</span><span class="o">.</span><span class="na">getLabel</span><span class="o">(</span><span class="s">&#34;while_block&#34;</span><span class="o">));</span>
</code></pre></td></tr></table>
</div>
</div><p>Take if as example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;IFTK&#34;</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">LABEL</span><span class="o">,</span> <span class="n">ifLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ifLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;if&#34;</span><span class="o">)));</span>
    <span class="o">...</span>
    <span class="n">analyseCond</span><span class="o">(</span><span class="s">&#34;IFTK&#34;</span><span class="o">);</span>
    <span class="o">...</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">JZ</span><span class="o">,</span> <span class="n">ifLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ifLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;else&#34;</span><span class="o">)));</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">LABEL</span><span class="o">,</span> <span class="n">ifLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ifLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;if_block&#34;</span><span class="o">)));</span>
    <span class="n">analyseStmt</span><span class="o">();</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">JMP</span><span class="o">,</span> <span class="n">ifLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ifLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;if_end&#34;</span><span class="o">)));</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">LABEL</span><span class="o">,</span> <span class="n">ifLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ifLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;else&#34;</span><span class="o">)));</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;ELSETK&#34;</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">getWord</span><span class="o">();</span> <span class="c1">//else
</span><span class="c1"></span>        <span class="n">analyseStmt</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">LABEL</span><span class="o">,</span> <span class="n">ifLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ifLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;if_end&#34;</span><span class="o">)));</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>while:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;WHILETK&#34;</span><span class="o">))</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">LABEL</span><span class="o">,</span> <span class="n">whileLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;while&#34;</span><span class="o">)));</span>
    <span class="o">...</span>
    <span class="n">analyseCond</span><span class="o">(</span><span class="s">&#34;WHILETK&#34;</span><span class="o">);</span>
    <span class="o">...</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">JZ</span><span class="o">,</span> <span class="n">whileLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;while_end&#34;</span><span class="o">)));</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">LABEL</span><span class="o">,</span> <span class="n">whileLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;while_block&#34;</span><span class="o">)));</span>
    <span class="n">analyseStmt</span><span class="o">();</span>
    <span class="o">...</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">JMP</span><span class="o">,</span> <span class="n">whileLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;while&#34;</span><span class="o">)));</span>
    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">LABEL</span><span class="o">,</span> <span class="n">whileLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;while_end&#34;</span><span class="o">)));</span>
    <span class="n">whileLabels</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// break
</span><span class="c1"></span><span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;BREAKTK&#34;</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">getWord</span><span class="o">();</span><span class="c1">//break
</span><span class="c1"></span>    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">JMP</span><span class="o">,</span> <span class="n">whileLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;while_end&#34;</span><span class="o">)));</span>
 		<span class="o">...</span>
<span class="o">}</span>

<span class="c1">// continue
</span><span class="c1"></span><span class="k">if</span> <span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">typeEquals</span><span class="o">(</span><span class="s">&#34;CONTINUETK&#34;</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">getWord</span><span class="o">();</span><span class="c1">//continue
</span><span class="c1"></span>    <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">JMP</span><span class="o">,</span> <span class="n">whileLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">whileLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;while&#34;</span><span class="o">)));</span>
    <span class="o">...</span>
<span class="o">}</span> 
</code></pre></td></tr></table>
</div>
</div><h3 id="after-code-3">After Code</h3>
<p>Because of some runtime errors and information shortages, I added and removed some Pcode. At the same, there are some new troubles about address pass and short circuit calculation.</p>
<h4 id="specific-code-definition-1">Specific Code Definition</h4>
<p>In Operation, <code>push()</code> means put value into the top of the stack. <code>pop()</code> means pop the value from the top of the stack.</p>
<h5 id="common-type">Common Type</h5>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>CodeType</th>
<th>Value1</th>
<th>Value2</th>
<th>Operation</th>
</tr>
</thead>
<tbody>
<tr>
<td>LABEL</td>
<td>Label_name</td>
<td>Set  a label</td>
<td></td>
</tr>
<tr>
<td>VAR</td>
<td>Ident_name</td>
<td>Declare  a variety</td>
<td></td>
</tr>
<tr>
<td>PUSH</td>
<td>Ident_name/Digit</td>
<td>push(value1)</td>
<td></td>
</tr>
<tr>
<td>POP</td>
<td>Address</td>
<td>Ident_name</td>
<td>*value1 = value2</td>
</tr>
<tr>
<td>JZ</td>
<td>Label_name</td>
<td></td>
<td>Jump if stack top is zero</td>
</tr>
<tr>
<td>JNZ</td>
<td>Label_name</td>
<td></td>
<td>Jump if stack top is not zero</td>
</tr>
<tr>
<td>JMP</td>
<td>Label_name</td>
<td></td>
<td>Jump unconditionally</td>
</tr>
<tr>
<td>MAIN</td>
<td></td>
<td></td>
<td>Main function label</td>
</tr>
<tr>
<td>FUNC</td>
<td></td>
<td></td>
<td>Function label</td>
</tr>
<tr>
<td>ENDFUNC</td>
<td></td>
<td></td>
<td>End of function label</td>
</tr>
<tr>
<td>PARA</td>
<td>Ident_name</td>
<td>Type</td>
<td>Parameters</td>
</tr>
<tr>
<td>RET</td>
<td>Return value or not</td>
<td></td>
<td>Function return</td>
</tr>
<tr>
<td>CALL</td>
<td>Function name</td>
<td></td>
<td>Function call</td>
</tr>
<tr>
<td>RPARA</td>
<td>Type</td>
<td></td>
<td>Get parameters ready for function call</td>
</tr>
<tr>
<td>GETINT</td>
<td></td>
<td></td>
<td>Get a integer and put it into stack top</td>
</tr>
<tr>
<td>PRINT</td>
<td>String</td>
<td>Para num</td>
<td>Pop values and print.</td>
</tr>
<tr>
<td>DIMVAR</td>
<td>Ident_name</td>
<td>Type</td>
<td>Set dimension info for array variety</td>
</tr>
<tr>
<td>VALUE</td>
<td>Ident_name</td>
<td>Type</td>
<td>Get the variety value</td>
</tr>
<tr>
<td>ADDRESS</td>
<td>Ident_name</td>
<td>Type</td>
<td>Get the variety address</td>
</tr>
<tr>
<td>PLACEHOLDER</td>
<td></td>
<td></td>
<td>Push something to hold places</td>
</tr>
<tr>
<td>EXIT</td>
<td></td>
<td></td>
<td>Exit</td>
</tr>
</tbody>
</table></div>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>CodeType</th>
<th>Value1</th>
<th>Value2</th>
<th>Operation</th>
</tr>
</thead>
<tbody>
<tr>
<td>ADD</td>
<td></td>
<td></td>
<td>+</td>
</tr>
<tr>
<td>SUB</td>
<td></td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>MUL</td>
<td></td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>DIV</td>
<td></td>
<td></td>
<td>/</td>
</tr>
<tr>
<td>MOD</td>
<td></td>
<td></td>
<td>%</td>
</tr>
<tr>
<td>CMPEQ</td>
<td></td>
<td></td>
<td>==</td>
</tr>
<tr>
<td>CMPNE</td>
<td></td>
<td></td>
<td>!=</td>
</tr>
<tr>
<td>CMPGT</td>
<td></td>
<td></td>
<td>&gt;</td>
</tr>
<tr>
<td>CMPLT</td>
<td></td>
<td></td>
<td>&lt;</td>
</tr>
<tr>
<td>CMPGE</td>
<td></td>
<td></td>
<td>&gt;=</td>
</tr>
<tr>
<td>CMPLE</td>
<td></td>
<td></td>
<td>&lt;=</td>
</tr>
<tr>
<td>AND</td>
<td></td>
<td></td>
<td>&amp;&amp;</td>
</tr>
<tr>
<td>OR</td>
<td></td>
<td></td>
<td>||</td>
</tr>
<tr>
<td>NOT</td>
<td></td>
<td></td>
<td>!</td>
</tr>
<tr>
<td>NEG</td>
<td></td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>POS</td>
<td></td>
<td></td>
<td>+</td>
</tr>
</tbody>
</table></div>
<h4 id="short-circuit-calculation">short circuit calculation</h4>
<p>There are two situations I need to use short circuit calculation :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="mf">1.</span> <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">)</span> <span class="c1">// a is false
</span><span class="c1"></span><span class="mf">2.</span> <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">||</span><span class="n">b</span><span class="p">)</span> <span class="c1">// b is true
</span></code></pre></td></tr></table>
</div>
</div><p>This seems not an easy thing and I acutally spent lots of time to solve it.</p>
<p>My method is as follows:</p>
<p>First, when I analyze <code>analyseLOrExp</code>, every <code>analyseLAndExp</code> will be followed by a <code>JNZ</code>, which is used for detect if the cond is false. If it is, jump to the if body label. At the same time, I generated cond label, which is ready for the <code>analyseLAndExp</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">analyseLOrExp</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">exp</span><span class="o">,</span> <span class="n">String</span> <span class="n">from</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="k">for</span> <span class="o">(...)</span> <span class="o">{</span>
        <span class="o">...</span>
        <span class="n">String</span> <span class="n">label</span> <span class="o">=</span> <span class="n">labelGenerator</span><span class="o">.</span><span class="na">getLabel</span><span class="o">(</span><span class="s">&#34;cond_&#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
        <span class="n">analyseLAndExp</span><span class="o">(</span><span class="n">exp1</span><span class="o">,</span> <span class="n">from</span><span class="o">,</span> <span class="n">label</span><span class="o">);</span>
        <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">LABEL</span><span class="o">,</span> <span class="n">label</span><span class="o">));</span>
        <span class="k">if</span> <span class="o">(...)</span> <span class="o">{</span>
            <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">OR</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(...)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(...)</span> <span class="o">{</span>
                <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">JNZ</span><span class="o">,</span> <span class="n">ifLabels</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ifLabels</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;if_block&#34;</span><span class="o">)));</span>
            <span class="o">}</span>
          <span class="o">...</span>
        <span class="o">}</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>In the <code>analyseLAndExp</code>, every <code>analyseEqExp</code> will be followed by a <code>JZ</code>, which is used for detect if the cond is true. If it is, jump to the cond label I set just now.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">analyseLAndExp</span><span class="o">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Word</span><span class="o">&gt;</span> <span class="n">exp</span><span class="o">,</span> <span class="n">String</span> <span class="n">from</span><span class="o">,</span> <span class="n">String</span> <span class="n">label</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="k">for</span> <span class="o">(...)</span> <span class="o">{</span>
        <span class="o">...</span>
        <span class="n">analyseEqExp</span><span class="o">(</span><span class="n">exp1</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(...)</span> <span class="o">{</span>
            <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">AND</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(...)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(...)</span> <span class="o">{</span>
                <span class="n">codes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PCode</span><span class="o">(</span><span class="n">CodeType</span><span class="o">.</span><span class="na">JZ</span><span class="o">,</span> <span class="n">label</span><span class="o">));</span>
            <span class="o">}</span> 
          <span class="o">...</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>By these means, short circuit calculation is solved.</p>
<h2 id="summary">Summary</h2>
<p>![[编译实验总结感想]]</p>
<h2 id="reference">Reference</h2>
<p><a class="link" href="https://www.bookstack.cn/read/pandolia-tinyc/about.md"  target="_blank" rel="noopener"
    >https://www.bookstack.cn/read/pandolia-tinyc/about.md</a></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/buaa/">BUAA</a>
        
            <a href="/tags/%E7%BC%96%E8%AF%91/">编译</a>
        
            <a href="/tags/%E9%A1%B9%E7%9B%AE/">项目</a>
        
            <a href="/tags/java/">Java</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 Mar 27, 2022 01:25 CST
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    

<aside class="related-contents--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-contents">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/%E5%85%B3%E4%BA%8E%E7%BC%96%E8%AF%91%E5%AE%9E%E9%AA%8C%E6%9C%9F%E6%9C%AB%E4%B8%8A%E6%9C%BA%E8%80%83%E8%AF%95/">
        
        

        <div class="article-details">
            <h2 class="article-title">关于编译实验期末上机考试</h2>
        </div>
    </a>
</article>
            
                
<article class="has-image">
    <a href="/takeawaydelivery-back/">
        
        
            <div class="article-image">
                
                    <img src="https://pic.mcatk.com/soto/202112170131240.png" loading="lazy" data-key="TakeawayDelivery-back" data-hash="https://pic.mcatk.com/soto/202112170131240.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">TakeawayDelivery 后端实现</h2>
        </div>
    </a>
</article>
            
                
<article class="has-image">
    <a href="/iotmonitor/">
        
        
            <div class="article-image">
                
                    <img src="https://tva1.sinaimg.cn/large/008i3skNly1gwuaqehi6ej30lg0eggmc.jpg" loading="lazy" data-key="" data-hash="https://tva1.sinaimg.cn/large/008i3skNly1gwuaqehi6ej30lg0eggmc.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">IoTMonitor</h2>
        </div>
    </a>
</article>
            
                
<article class="has-image">
    <a href="/memo%E6%96%87%E6%A1%A3/">
        
        
            <div class="article-image">
                
                    <img src="https://tva1.sinaimg.cn/large/008i3skNly1gwv08ty64aj31340m4761.jpg" loading="lazy" data-key="" data-hash="https://tva1.sinaimg.cn/large/008i3skNly1gwv08ty64aj31340m4761.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Memo文档</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/buaaoo-%E7%AC%AC%E5%9B%9B%E5%8D%95%E5%85%83%E6%80%BB%E7%BB%93/">
        
        

        <div class="article-details">
            <h2 class="article-title">BUAAOO-第四单元总结</h2>
        </div>
    </a>
</article>
            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 SOTO-BLOG
    </section>

    <a href="https://beian.miit.gov.cn/" target="_blank">京ICP备2020039419号-1</a>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.5.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#lexical-analysis">Lexical analysis</a>
      <ol>
        <li><a href="#before-code">Before Code</a>
          <ol>
            <li><a href="#file-reading">File reading</a></li>
            <li><a href="#analyse">Analyse</a></li>
            <li><a href="#word">Word</a></li>
          </ol>
        </li>
        <li><a href="#after-code">After Code</a>
          <ol>
            <li><a href="#file-reading-1">File reading</a></li>
            <li><a href="#analyse-1">Analyse</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#grammatical-analysis">Grammatical analysis</a>
      <ol>
        <li><a href="#before-code-1">Before Code</a>
          <ol>
            <li><a href="#data-reading">Data Reading</a></li>
            <li><a href="#recursive-descent">recursive descent</a></li>
            <li><a href="#left-recursion">left recursion</a></li>
          </ol>
        </li>
        <li><a href="#after-code-1">After Code</a>
          <ol>
            <li><a href="#left-recursion-1">left recursion</a></li>
            <li><a href="#other-bugs">other bugs</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#error-handling">Error handling</a>
      <ol>
        <li><a href="#before-code-2">Before Code</a>
          <ol>
            <li><a href="#create-the-symbol-table">Create the symbol table</a></li>
            <li><a href="#errors">Errors</a></li>
          </ol>
        </li>
        <li><a href="#after-code-2">After Code</a>
          <ol>
            <li><a href="#area">Area</a></li>
            <li><a href="#error-d-and-e">Error d and e</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#code-generation">Code generation</a>
      <ol>
        <li><a href="#before-code-3">Before Code</a>
          <ol>
            <li><a href="#how-does-the-virtual-machine-run">How does the virtual machine run</a></li>
            <li><a href="#how-to-distinguish-different-variety">How to distinguish different variety</a></li>
            <li><a href="#specific-code-definition">Specific Code Definition</a></li>
            <li><a href="#function-call-procedure">Function call procedure</a></li>
            <li><a href="#value-or-address">Value or Address</a></li>
            <li><a href="#code-generate">Code Generate</a></li>
          </ol>
        </li>
        <li><a href="#after-code-3">After Code</a>
          <ol>
            <li><a href="#specific-code-definition-1">Specific Code Definition</a></li>
            <li><a href="#short-circuit-calculation">short circuit calculation</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#reference">Reference</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
