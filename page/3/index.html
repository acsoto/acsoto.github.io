<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"atksoto.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="SOTO的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="SOTO-BLOG">
<meta property="og:url" content="http://atksoto.com/page/3/index.html">
<meta property="og:site_name" content="SOTO-BLOG">
<meta property="og:description" content="SOTO的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="soto">
<meta property="article:tag" content="随想">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="生活">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://atksoto.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>SOTO-BLOG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">SOTO-BLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://atksoto.com/posts/29594/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="soto">
      <meta itemprop="description" content="SOTO的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SOTO-BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/29594/" class="post-title-link" itemprop="url">关于封校的行为艺术——很有冲击力</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-22 15:28:59" itemprop="dateCreated datePublished" datetime="2021-11-22T15:28:59+08:00">2021-11-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-23 10:17:00" itemprop="dateModified" datetime="2021-11-23T10:17:00+08:00">2021-11-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今日看到北京电影学院的行为艺术，甚感封校许久政策就是最明显的校内不同群体的利益冲突，比如在BUAA，冲封校冲得最厉害的，似乎是大四的同学，因为很多人急于出去实习科研。对于一些每天的生活只有卷的同学，封校政策并无大碍。对于北航家属呢，此政策影响不到他们的正常出行。对于我呢，在我想出去玩的时候，对政策感到厌恶，在我不想出玩的时候，却也觉得无所谓。</p>
<p>《肖申克的救赎》</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gwov7m0x7uj30u00uxq4x.jpg"></p>
<p>更新于2021-11-23 10:17</p>
<p>昨天刚吐槽完这个，今天BUAA就改报备制了，近期也并无心出门</p>
<p>《不至于》</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gwovactdgfj310c0csq3b.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://atksoto.com/posts/30385/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="soto">
      <meta itemprop="description" content="SOTO的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SOTO-BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/30385/" class="post-title-link" itemprop="url">最近在听</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-20 02:08:05" itemprop="dateCreated datePublished" datetime="2021-11-20T02:08:05+08:00">2021-11-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-27 02:13:13" itemprop="dateModified" datetime="2021-11-27T02:13:13+08:00">2021-11-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="150" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/album/%E5%B9%BB%E3%81%AE%E5%91%BD/1199215327?i=1199215774&l=en"></iframe>

<p>苍白星辰于苍穹陨落</p>
<p>April 30, 2005<br>Our child became the phantom<br>We named “The life of phantom” Tsukushi<br>It was a night with the red moon<br>Blazing beautifully, beautifully</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="150" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/album/%E5%A6%82%E6%84%BF/1591180618?i=1591180619&l=en"></iframe>

<p>而我将爱你所爱的人间 愿你所愿的笑颜</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="150" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/album/%E7%AB%B9%E6%9E%97/1592835688?i=1592835695&l=en"></iframe>

<p>年年不相忘 月月常记起</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="150" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/album/%E6%8A%89%E6%93%87/905228605?i=905228622&l=en"></iframe>

<p>也许雨一停 我就能再见到你</p>
<p>也许雨该一直下不停</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="150" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/album/the-four-seasons-concerto-no-4-in-f-minor-rv-297/883897569?i=883897598&l=en"></iframe>


<p>凛冬将至 灵魂却燃烧着 感慨着 悲壮着</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="150" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/album/%E6%B8%A1%E5%8F%A3/905228605?i=905228635&l=en"></iframe>
让我与你握别 再轻轻抽出我的手

<p>是那样万般无奈的凝视</p>
<iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="150" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/album/fathers-grassland-and-mothers-river/425314751?i=425314759&l=en"></iframe>

<p>我也是高原的孩子啊 心里有一首歌</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://atksoto.com/posts/27481/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="soto">
      <meta itemprop="description" content="SOTO的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SOTO-BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/27481/" class="post-title-link" itemprop="url">何以变革</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-20 01:53:10" itemprop="dateCreated datePublished" datetime="2021-11-20T01:53:10+08:00">2021-11-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-29 13:24:55" itemprop="dateModified" datetime="2021-11-29T13:24:55+08:00">2021-11-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>大部分人做着自己不想做的事情，只是为了生存，这点有史以来未曾改变。有人只是爱好，有人只是在追求功利，摆出一副难看的样子，卑微的为了让自己能或许多有一点点微乎其微的可能性，去屈服，痛苦，下跪，丧失着自由。何以变革，或许少部分值得敬佩的，才是异类。</p>
<p>我选择方式越来越趋向于同一个准则，或许是积累了那么多经验，觉得只要这样做才是应该的，才能让自己快乐，当然，这样的选择方式，在遵循的同时，也不失会带来一些焦虑，然后我又去抑制这种焦虑？就不知道是自己在习惯的过程中，还是做错了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://atksoto.com/posts/22522/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="soto">
      <meta itemprop="description" content="SOTO的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SOTO-BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/22522/" class="post-title-link" itemprop="url">与鸟巢的匆匆一面</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-19 23:34:01" itemprop="dateCreated datePublished" datetime="2021-11-19T23:34:01+08:00">2021-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-30 22:24:44" itemprop="dateModified" datetime="2021-11-30T22:24:44+08:00">2021-11-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今赴一场蓄谋已久的生日宴会，开场一个半小时后先行撤退且不辞而别，在此先把责任全部归咎于我自己，母上也对我的行为直呼无趣，倒也不是自讨没趣，只是封校许久难得有机会出来，想要自行去溜达一圈。</p>
<p>我在乘车前往目的地的路上，看到鸟巢灯火通明的一瞬间，突然感到与繁景告别已久（一个多月），仿佛自己离开了这个城市。恍然间审视起来自己这一个月真的是在有意义的活着吗？貌似是陷在编译里面虚度时间。忽然想起那句：北航人是没有生活的(<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/ePycPzAVIXsyFPWTIV9fQQ">链接</a>)，直呼赞同。故在按部就班完成生日的惊喜后按耐不住，感觉在座的各位都有自己在这一场聚会中想要做的事情，我不甚相融其中，只想奔赴鸟巢，而且还有点饿，想吃点告别已久的，学校外边的食物，遂离开。</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gwoctuf5vvj30sg0lcn00.jpg"></p>
<p>奔赴鸟巢并不顺利，沿湖东路莫名被封，我四处绕路，路上遇见几位也是如此，最后还是从东侧大道进入，赶在闭园的前几分钟，好心的保安提示我赶紧进去，进去后反倒不如在湖边拍下的风景好，中轴线的人也不多，只有几个年轻人还在滑滑板，却也算完成了今日的心愿。</p>
<p>见到倒计时板只剩下76天，想到第一次来这个地方，已相隔七百来天，不甚感慨，在BUAA的这两年，在北京的这两年。</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gwocrn2scqj31he0u077j.jpg"></p>
<p>离开之际，地铁口附近有一些劲爆的音乐和放纵的，各个年龄段的朝阳群众正在狂欢。待了一会儿，离开了，也没吃到饭。（回BUAA吃了难吃的烤冷面和土豆）</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gwocti2xgxj30sg0lcq5j.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://atksoto.com/posts/12888/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="soto">
      <meta itemprop="description" content="SOTO的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SOTO-BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/12888/" class="post-title-link" itemprop="url">Unknown collation- 'utf8mb4_0900_ai_ci'</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-19 10:09:18" itemprop="dateCreated datePublished" datetime="2021-11-19T10:09:18+08:00">2021-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-27 02:13:13" itemprop="dateModified" datetime="2021-11-27T02:13:13+08:00">2021-11-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>运行sql脚本时</p>
<p>sql报错如下</p>
<p>Unknown collation: ‘utf8mb4_0900_ai_ci’</p>
<p>原因mySQL版本不兼容，将sql文件中 utf8mb4_0900_ai_ci 替换成 utf8mb4_general_ci </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://atksoto.com/posts/35016/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="soto">
      <meta itemprop="description" content="SOTO的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SOTO-BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/35016/" class="post-title-link" itemprop="url">编译实验总结感想</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-16 16:29:01" itemprop="dateCreated datePublished" datetime="2021-11-16T16:29:01+08:00">2021-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-01 17:03:40" itemprop="dateModified" datetime="2021-12-01T17:03:40+08:00">2021-12-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>相关文章：[[Alxa_Compiler 编译器]]</p>
<h2 id="总结感想"><a href="#总结感想" class="headerlink" title="总结感想"></a>总结感想</h2><p>先说说关于选择PCODE，选择了PCODE，早早结束了编译实验的全部任务，也没经过很多人在选择mips85+还是选择PCODE+85的痛苦，私以为我不愿陷入焦虑去纠结这个什么给分高低，也不想浪费大量时间去研究怎么生成mips和卷优化，因为这不是我想做和喜欢的事情。也不为别的，就是想要轻松一点，节省时间做点自己想做的事情。当然，生成PCODE反而是我感觉更能让我觉得有趣的事情，无需遵循某种既定的体系（虽然这可能对我没有好处），而是自己设计了PCODE指令，一边从递归下降中生成指令，一边写虚拟机解释器，在这之间，我不断修改指令生成和解释器，感觉自己能够完全地掌控这个我亲手写的编译器，最后让虚拟机完整地成功地跑代码，反而对我来说是一件很有成就感的事情。</p>
<p>至于[[设计文档]]为什么要写成英文，首先，想要更方便更直观地描述代码，类，对象，与其给每一个东西一个汉语解释，我认为干脆用英文来描述更显自然，第二，想在写文档的同时顺便练练英语，仅此而已。不是想给助教和看我文档的人添麻烦，如果很不方便阅读，可以翻译成汉语再读，亲测用有道翻译完还是可以看懂的，实在不行也可以来垂询我本人。总结当然就不写英语了，毕竟不是母语。</p>
<p>关于一些反思，在语法分析和代码生成两部分，我还是没有设计好架构就开始写，完工后出现了较多bug，甚至在代码生成de到了语法分析时候的bug，在面向对象课程的时候，已经多次反思过这件事，这实属不该，在今后的大型工程中，要继续好好注意架构设计。也非常感谢在我debug过程中帮到我的zyq，lyx，dky同学。</p>
<p>最后，站在我个人的角度，我认为从词法分析，语法分析，错误处理，到代码生成这四个任务，已经很好的做到了让我对一个编译器体系架构充分理解并让我把它完整的做出来，对我个人而言，这已经完整了，我算是轻松愉快地（除了在语法分析和代码生成两次任务debug的时候属实不太顺利）完成了编译实验，很有成就感，且收获颇丰。</p>
<h2 id="意见建议"><a href="#意见建议" class="headerlink" title="意见建议"></a>意见建议</h2><p>首先，个人认为课程实验的安排很好，虽然在初期阶段不是很清楚后面要做什么，但是课程组的词法分析和语法分析的作业要求很好的贯彻了一点，尽管我没有设计好后边怎么进行代码生成，因为词法分析中对每个Token的正确生成，语法分析中正确的递归下降，也可以很好地设计出正确的编译前端，错误处理同样很有帮助，在设计错误处理的时候进行了符号表的设计，以及在debug的过程中更清晰的认知了数组传参的过程，以至于在代码生成阶段不会出现过多需要考虑的问题，四次实验，基本没有出现完全不知道怎么做的情况，也没有出现某一次实验过于困难或简单的情况，总体体验还是很好的。</p>
<p>官方提供的辅助测试库也非常友好，同学们做的测试集非常好，通过学号还可以询问其本人，让debug变得轻松了不少。错误处理实验，虽然没有官方提供的测试数据，在讨论区也有同学热心提供了样例。</p>
<p>该学年我们有幸第一次可以使用Java，我本人也是使用了Java写这个编译器，个人认为同学们更熟悉Java语言，可以更好的把注意力放在编译器的架构设计上，C++会让这个过程提高难度。</p>
<p>这门课程的实验很完善，确实提不出大方向的建议，细节上有以下几点：</p>
<ul>
<li>Judge平台登陆页面的表单存在一些问题，不能直接触发浏览器的密码填充，需要点三次或者先输入几个字符再删掉</li>
<li>期中考试时评测机体验实在太差了，在等待评测上耗费了大量时间</li>
<li>不理解设计文档为什么只能是压缩包，不能交pdf</li>
</ul>
<p>感谢编译实验课程组的辛勤教学！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://atksoto.com/posts/51052/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="soto">
      <meta itemprop="description" content="SOTO的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SOTO-BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/51052/" class="post-title-link" itemprop="url">Alxa_Compiler 编译器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-16 16:29:00" itemprop="dateCreated datePublished" datetime="2021-11-16T16:29:00+08:00">2021-11-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-01 16:56:19" itemprop="dateModified" datetime="2021-12-01T16:56:19+08:00">2021-12-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>相关文章：[[编译实验总结感想]]</p>
<h2 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h2><h3 id="Before-Code"><a href="#Before-Code" class="headerlink" title="Before Code"></a>Before Code</h3><p>Requriement:  read <code>testfile.txt</code>, parse every char to word and print them. At the same time, memorize type, content and line number of  each word.</p>
<h4 id="File-reading"><a href="#File-reading" class="headerlink" title="File reading"></a>File reading</h4><p>Read by line, scan every char of every string and analyse.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ((s = bf.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Analyse"><a href="#Analyse" class="headerlink" title="Analyse"></a>Analyse</h4><p>When i get the key word, enter the next analyst. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ((c = getChar()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27; &#x27;</span> || c == <span class="string">&#x27;\r&#x27;</span> || c == <span class="string">&#x27;\t&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;+&#x27;</span> || c == <span class="string">&#x27;-&#x27;</span> || c == <span class="string">&#x27;*&#x27;</span> || c == <span class="string">&#x27;%&#x27;</span>) &#123;</span><br><span class="line">    words.add(<span class="keyword">new</span> Word(c));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    analyseSlash();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;(&#x27;</span> || c == <span class="string">&#x27;)&#x27;</span> || c == <span class="string">&#x27;[&#x27;</span> || c == <span class="string">&#x27;]&#x27;</span> || c == <span class="string">&#x27;&#123;&#x27;</span> || c == <span class="string">&#x27;&#125;&#x27;</span>) &#123;</span><br><span class="line">    words.add(<span class="keyword">new</span> Word(c));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;&gt;&#x27;</span> || c == <span class="string">&#x27;&lt;&#x27;</span> || c == <span class="string">&#x27;=&#x27;</span> || c == <span class="string">&#x27;!&#x27;</span>) &#123;</span><br><span class="line">    analyseRelation(c);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;,&#x27;</span> || c == <span class="string">&#x27;;&#x27;</span>) &#123;</span><br><span class="line">    words.add(<span class="keyword">new</span> Word(c));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;&quot;&#x27;</span>) &#123;</span><br><span class="line">    analyseCitation();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;&amp;&#x27;</span> || c == <span class="string">&#x27;|&#x27;</span>) &#123;</span><br><span class="line">    analyseLogic(c);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Character.isDigit(c)) &#123;</span><br><span class="line">    analyseDigit(c);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Character.isLetter(c) || c == <span class="string">&#x27;_&#x27;</span>) &#123;</span><br><span class="line">    analyseLetter(c);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Common"><a href="#Common" class="headerlink" title="Common"></a>Common</h5><p>For example, when I get ‘+’, I directly new a Word typify the “PLUS”.</p>
<h5 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h5><p>For example</p>
<p>When I get <code>&lt;</code> , enter function<code>analyseRelation</code> read one char more. If it is<code>=</code>, analyze <code>LEQ</code>…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (c == <span class="string">&#x27;&lt;&#x27;</span>) &#123;</span><br><span class="line">  c = getChar();</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27;=&#x27;</span>) &#123;</span><br><span class="line">    words.add(<span class="keyword">new</span> Word(<span class="string">&quot;&lt;=&quot;</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    unGetChar();</span><br><span class="line">    words.add(<span class="keyword">new</span> Word(<span class="string">&quot;&lt;&quot;</span>));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><code>analyseLogic</code> is as the same.</p>
<h5 id="Digit-and-Letter"><a href="#Digit-and-Letter" class="headerlink" title="Digit and Letter"></a>Digit and Letter</h5><p>Digit: When I get a digit, it means I will scan a serial of some digits and turn them into a Word typify “INTCON”.</p>
<p>Letter: When I get a letter, it means I will scan a string about letter or digit. It maybe a “IDENFR” or “STRCON”, which depends on whether it is in key map or not. </p>
<h4 id="Word"><a href="#Word" class="headerlink" title="Word"></a>Word</h4><p>class Word:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Word</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String identification;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Capsulate the initial function, I only need to <code>new Word(...)</code> in the main processor, which will create the corresponding word.</p>
<p>For example</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Word</span><span class="params">(<span class="keyword">char</span> identification)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.identification = String.valueOf(identification);</span><br><span class="line">    <span class="keyword">this</span>.type = <span class="keyword">new</span> KeyWordMap().getType(<span class="keyword">this</span>.identification);</span><br><span class="line">    <span class="keyword">this</span>.content = <span class="keyword">this</span>.identification;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As for KeyWordMap, it is a HashMap, mapping the string of word and its type.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">KeyWordMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    keyWords = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    keyWords.put(<span class="string">&quot;main&quot;</span>, <span class="string">&quot;MAINTK&quot;</span>);</span><br><span class="line">    keyWords.put(<span class="string">&quot;const&quot;</span>, <span class="string">&quot;CONSTTK&quot;</span>);</span><br><span class="line">    keyWords.put(<span class="string">&quot;int&quot;</span>, <span class="string">&quot;INTTK&quot;</span>);</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="After-Code"><a href="#After-Code" class="headerlink" title="After Code"></a>After Code</h3><h4 id="File-reading-1"><a href="#File-reading-1" class="headerlink" title="File reading"></a>File reading</h4><p>Read file by line is not convenient for preread and undo, so I read the file into a single String at first. </p>
<p>The method is read by line, add <code>\n</code> after every line and scan every char. When I get <code>\n</code>, <code>lineNum++</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">transferFileToCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    BufferedReader bf = <span class="keyword">new</span> BufferedReader(reader);</span><br><span class="line">    StringBuffer buffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    String s = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((s = bf.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        buffer.append(s).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> buffer.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Analyse-1"><a href="#Analyse-1" class="headerlink" title="Analyse"></a>Analyse</h4><p>About analyst, it is different from what before coding.</p>
<p>First, I need analyze word one by one, so I add global variety <code>index</code> to memorize where is the pointer. </p>
<p>Besides, I met the situation that I need read one more or undo, so I  encapsulate the function <code>ungetChar</code> and <code>getChar</code>, which will be convenient for me to analyze. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Character <span class="title">getChar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; code.length()) &#123;</span><br><span class="line">        <span class="keyword">char</span> c = code.charAt(index);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">            lineNum++;</span><br><span class="line">        &#125;</span><br><span class="line">        index++;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unGetChar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    index--;</span><br><span class="line">    <span class="keyword">char</span> c = code.charAt(index);</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">        lineNum--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Slash"><a href="#Slash" class="headerlink" title="Slash"></a>Slash</h5><ol>
<li><code>//</code> : When it comes to <code>\n</code> , stop.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  c = getChar();</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="keyword">null</span> || c == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 判断为//注释，结束分析</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>/* */</code>: Get char until <code>*/</code> appears</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  c = getChar();</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">    c = getChar();</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">      <span class="comment">// 判断为/* */注释，直接结束分析</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      unGetChar();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<h2 id="语法分析"><a href="#语法分析" class="headerlink" title="语法分析"></a>语法分析</h2><p>Requirement: Based on the words identified by the lexical analysis program, identify various grammatical elements according to the grammatical rules. Recursive descent method is used to analyze the grammatical components defined in the grammar.</p>
<h3 id="Before-Code-1"><a href="#Before-Code-1" class="headerlink" title="Before Code"></a>Before Code</h3><h4 id="Data-Reading"><a href="#Data-Reading" class="headerlink" title="Data Reading"></a>Data Reading</h4><p>Like the lexical analyst, I prepared function  <code>getWord</code> <code>getNextWord</code> and so on. At the same time, there is a global variety <code>(Word) curWord</code> to display which word it is when I read <code>ArrayList&lt;Word&gt; words </code> from lexical analyst one by one.    </p>
<p>My analyst tragedy is as follows:</p>
<p>To normal rule: I keep getting words and analyze them</p>
<p>To expression rule: I scan the whole expression first, which is implemented by function <code>getExp</code>. Then I divide the expression and use method recursive descent to analyze them.</p>
<p><code>getExp</code> like</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ArrayList&lt;Word&gt; <span class="title">getExp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ArrayList&lt;Word&gt; exp = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (word is symbol of end) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">        getWordWithoutAddToGrammar();</span><br><span class="line">        exp.add(curWord);</span><br><span class="line">        word = getNextWord();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> exp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="recursive-descent"><a href="#recursive-descent" class="headerlink" title="recursive descent"></a>recursive descent</h4><p>According to Grammatical Rules, code function for every term of rule.</p>
<p>Main idea: read a word, check what it symbolize and enter the next analyzing function.  </p>
<p>For example:</p>
<p>to</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CompUnit → &#123;Decl&#125; &#123;FuncDef&#125; MainFuncDef <span class="comment">// 1.是否存在Decl 2.是否存在 FuncDef</span></span><br></pre></td></tr></table></figure>

<p>I analyze like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">analyseCompUnit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Word word = getNextWord();</span><br><span class="line">  <span class="keyword">while</span> (word.typeEquals(<span class="string">&quot;CONSTTK&quot;</span>) || (</span><br><span class="line">    word.typeEquals(<span class="string">&quot;INTTK&quot;</span>) &amp;&amp; getNext2Word().typeEquals(<span class="string">&quot;IDENFR&quot;</span>) &amp;&amp; !getNext3Word().typeEquals(<span class="string">&quot;LPARENT&quot;</span>))) &#123;</span><br><span class="line">    analyseDecl();</span><br><span class="line">    word = getNextWord();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (word.typeEquals(<span class="string">&quot;VOIDTK&quot;</span>) || (</span><br><span class="line">    (word.typeEquals(<span class="string">&quot;INTTK&quot;</span>) &amp;&amp; !getNext2Word().typeEquals(<span class="string">&quot;MAINTK&quot;</span>)))) &#123;</span><br><span class="line">    analyseFuncDef();</span><br><span class="line">    word = getNextWord();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;INTTK&quot;</span>) &amp;&amp; getNext2Word().typeEquals(<span class="string">&quot;MAINTK&quot;</span>)) &#123;</span><br><span class="line">    analyseMainFuncDef();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    error();</span><br><span class="line">  &#125;</span><br><span class="line">  grammar.add(<span class="string">&quot;&lt;CompUnit&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>grammar is used for memorize output of lexical analyst and grammar analyst list. </p>
<h4 id="left-recursion"><a href="#left-recursion" class="headerlink" title="left recursion"></a>left recursion</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">加减表达式 AddExp → MulExp | AddExp (<span class="string">&#x27;+&#x27;</span> | <span class="string">&#x27;−&#x27;</span>) MulExp <span class="comment">// 1.MulExp 2.+ 需覆盖 3.- 需覆盖</span></span><br></pre></td></tr></table></figure>

<p>Check if the exp has ‘+’ or ‘-‘. If it has, separate the exp to AddExp and  MulExp. Then analyze them separately. </p>
<h3 id="After-Code-1"><a href="#After-Code-1" class="headerlink" title="After Code"></a>After Code</h3><h4 id="left-recursion-1"><a href="#left-recursion-1" class="headerlink" title="left recursion"></a>left recursion</h4><p>The method used before is not perfect for recursive descent. So I changed my rewrite way.</p>
<p>to</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">加减表达式 AddExp → MulExp | AddExp (<span class="string">&#x27;+&#x27;</span> | <span class="string">&#x27;−&#x27;</span>) MulExp <span class="comment">// 1.MulExp 2.+ 需覆盖 3.- 需覆盖</span></span><br></pre></td></tr></table></figure>

<p>Rewrite it like </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddExp → MulExp (<span class="string">&#x27;+&#x27;</span> | <span class="string">&#x27;−&#x27;</span>) MulExp  (<span class="string">&#x27;+&#x27;</span> | <span class="string">&#x27;−&#x27;</span>) MulExp ...</span><br></pre></td></tr></table></figure>

<p>Code like </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">analyseMulExp</span><span class="params">(ArrayList&lt;Word&gt; exp)</span> </span>&#123;</span><br><span class="line">  Exps exps = divideExp(exp, <span class="keyword">new</span> ArrayList&lt;&gt;(Arrays.asList(<span class="string">&quot;MULT&quot;</span>, <span class="string">&quot;DIV&quot;</span>, <span class="string">&quot;MOD&quot;</span>)));</span><br><span class="line">  <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (ArrayList&lt;Word&gt; exp1 : exps.getWords()) &#123;</span><br><span class="line">    analyseUnaryExp(exp1);</span><br><span class="line">    grammar.add(<span class="string">&quot;&lt;MulExp&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (j &lt; exps.getSymbols().size()) &#123;</span><br><span class="line">      grammar.add(exps.getSymbols().get(j++).toString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Function <code>divideExp</code> is used for divide the whole exp passed by <code>getExp</code> or the pre function.</p>
<p><code>divideExp</code>:</p>
<p>In: orignal: <code>exp</code> stop symbol:  <code>symbol</code></p>
<p>Out: List of divided exp and symbol.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Exps <span class="title">divideExp</span><span class="params">(ArrayList&lt;Word&gt; exp, ArrayList&lt;String&gt; symbol)</span> </span>&#123;</span><br><span class="line">  ArrayList&lt;ArrayList&lt;Word&gt;&gt; exps = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  ArrayList&lt;Word&gt; exp1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  ArrayList&lt;Word&gt; symbols = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  <span class="keyword">boolean</span> unaryFlag = <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">int</span> flag1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> flag2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; exp.size(); i++) &#123;</span><br><span class="line">    Word word = exp.get(i);</span><br><span class="line">    <span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;LPARENT&quot;</span>)) &#123;</span><br><span class="line">      flag1++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;RPARENT&quot;</span>)) &#123;</span><br><span class="line">      flag1--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;LBRACK&quot;</span>)) &#123;</span><br><span class="line">      flag2++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;RBRACK&quot;</span>)) &#123;</span><br><span class="line">      flag2--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (symbol.contains(word.getType()) &amp;&amp; flag1 == <span class="number">0</span> &amp;&amp; flag2 == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//UnaryOp</span></span><br><span class="line">      <span class="keyword">if</span> (word.typeOfUnary()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!unaryFlag) &#123;</span><br><span class="line">          exp1.add(word);</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      exps.add(exp1);</span><br><span class="line">      symbols.add(word);</span><br><span class="line">      exp1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      exp1.add(word);</span><br><span class="line">    &#125;</span><br><span class="line">    unaryFlag = word.typeEquals(<span class="string">&quot;IDENFR&quot;</span>) || word.typeEquals(<span class="string">&quot;RPARENT&quot;</span>) || word.typeEquals(<span class="string">&quot;INTCON&quot;</span>) || word.typeEquals(<span class="string">&quot;RBRACK&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  exps.add(exp1);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Exps(exps, symbols);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Exps</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exps</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;ArrayList&lt;Word&gt;&gt; words;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Word&gt; symbols;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="other-bugs"><a href="#other-bugs" class="headerlink" title="other bugs"></a>other bugs</h4><p>Most bugs are produced by function <code>getExp</code> and <code>divideExp</code> because of some situations are ignored. So I always get something like index out of range…</p>
<p>So I changed some symbol of stop getting expression and modify the rules to divide or not the expression and so on.</p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><h3 id="Before-Code-2"><a href="#Before-Code-2" class="headerlink" title="Before Code"></a>Before Code</h3><h4 id="Create-the-symbol-table"><a href="#Create-the-symbol-table" class="headerlink" title="Create the symbol table"></a>Create the symbol table</h4><p>Symbol class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Symbol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intType;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> area = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Type means the type of the symbol.</p>
<p>IntType is an integer. If it’s 0, the symbol is int. if it’s 1, the symbol is int[],  if it’s 2, the symbol is int[] []…</p>
<p>Content is its content.</p>
<p>Area is where is it.</p>
<p>I create a HashMap of Symbols, memorizing symbols created in each area.</p>
<p>When I enter a new area, area++. When I leave an area, area–, with the corresponding Symbols are destroyed. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HashMap&lt;Integer, Symbols&gt; symbols = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"><span class="keyword">private</span> HashMap&lt;String, Function&gt; functions = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"><span class="keyword">private</span> ArrayList&lt;Error&gt; errors = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> area = -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> needReturn = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> whileFlag = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p><code>needReturn</code> means if the current function need to return.</p>
<p><code>whileFlag </code> means if the current code block is in while circle.</p>
<h4 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h4><h5 id="a"><a href="#a" class="headerlink" title="a"></a><strong>a</strong></h5><p>Just check format</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFormatIllegal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; content.length() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">char</span> c = content.charAt(i);</span><br><span class="line">    <span class="keyword">if</span> (!isLegal(c)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (c == <span class="string">&#x27;%&#x27;</span> &amp;&amp; content.charAt(i + <span class="number">1</span>) == <span class="string">&#x27;d&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (c == <span class="string">&#x27;\\&#x27;</span> &amp;&amp; content.charAt(i + <span class="number">1</span>) != <span class="string">&#x27;n&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="b-c"><a href="#b-c" class="headerlink" title="b c"></a><strong>b c</strong></h5><p>B: Every time I get an identity, check if there is the same symbol has been defined in this area.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">hasSymbolInThisArea</span><span class="params">(Word word)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> symbols.get(area).hasSymbol(word);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>C: Check all area. If the symbol has been defined. Functions are as the same.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">hasSymbol</span><span class="params">(Word word)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Symbols s : symbols.values()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s.hasSymbol(word)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="d-e"><a href="#d-e" class="headerlink" title="d e"></a><strong>d e</strong></h5><p>To check if the function parameters are matched, I memorize parameters of every function and when I met a function call, I will scan the function call parameters and match them. I prepare a function to do this. Finally I found I need to use recursive descent again, so I add the check procedure to the recursive descent of the grammatical analyst. Please check the <code>After Code/Error d and e</code></p>
<h5 id="f-g"><a href="#f-g" class="headerlink" title="f g"></a>f g</h5><p>There is a global variety <code>needReturn</code> used to display if the current function need return. if it does but there is no return in the end of the code block, or if it doesn’t but there is return, the error will be memorized.</p>
<h5 id="h"><a href="#h" class="headerlink" title="h"></a><strong>h</strong></h5><p>Just check if it is a const. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isConst(word)) &#123;</span><br><span class="line">  error(<span class="string">&quot;h&quot;</span>, word.getLineNum());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="i-j-k"><a href="#i-j-k" class="headerlink" title="i j k"></a><strong>i j k</strong></h5><p>Capsulate function about checking missing of the symbol</p>
<p>For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getNextWord().typeEquals(<span class="string">&quot;RPARENT&quot;</span>)) &#123;</span><br><span class="line">        getWord();<span class="comment">// )</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        error(<span class="string">&quot;j&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="l"><a href="#l" class="headerlink" title="l"></a><strong>l</strong></h5><p>Count the number of the parameters of string and printf separately and check if they equal.</p>
<h5 id="m"><a href="#m" class="headerlink" title="m"></a><strong>m</strong></h5><p>There is a global variety <code>whileFlag</code> symbolize if the code block is in while circle. If it isn’t, any continue and break will produce error.</p>
<h3 id="After-Code-2"><a href="#After-Code-2" class="headerlink" title="After Code"></a>After Code</h3><h4 id="Area"><a href="#Area" class="headerlink" title="Area"></a>Area</h4><p>I mark the area++ when I get a block or a function, but it will lead to the situation that when enter a code block of a function, the parameters of the function can’t be memorize in the different are with the block of the function. So I changed the rules to mark area++.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">analyseBlock</span><span class="params">(<span class="keyword">boolean</span> fromFunc)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (!fromFunc) &#123;</span><br><span class="line">        addArea();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Only when the block is not from the function, the area++.</p>
<h4 id="Error-d-and-e"><a href="#Error-d-and-e" class="headerlink" title="Error d and e"></a>Error d and e</h4><p>To check if the function parameters are matched, I set an array for every function.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Function</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> String returnType;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Integer&gt; paras;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When I get a function, I memorize its return type and paras.</p>
<p>As for the <code>ArrayList&lt;Integer&gt; paras</code>, it reflects as follows:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Example</th>
<th>Integer</th>
</tr>
</thead>
<tbody><tr>
<td>Void</td>
<td></td>
<td>-1</td>
</tr>
<tr>
<td>Int</td>
<td>a</td>
<td>0</td>
</tr>
<tr>
<td>Int[]</td>
<td>a[]</td>
<td>1</td>
</tr>
<tr>
<td>Int[] []</td>
<td>a[] [3]</td>
<td>2</td>
</tr>
</tbody></table>
<p>So when I get a function call, I will check the parameter of it with what I have memorized before.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkParasMatchRParas</span><span class="params">(Word ident, ArrayList&lt;Integer&gt; paras, ArrayList&lt;Integer&gt; rparas)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (paras.size() != rparas.size()) &#123;</span><br><span class="line">        error(<span class="string">&quot;d&quot;</span>, ident.getLineNum());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; paras.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!paras.get(i).equals(rparas.get(i))) &#123;</span><br><span class="line">                error(<span class="string">&quot;e&quot;</span>, ident.getLineNum());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As for getting the parameters real type, I add the analyst procedure to the recursive descent of the grammatical analyst. Just like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">analyseExp</span><span class="params">(ArrayList&lt;Word&gt; exp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> intType = analyseAddExp(exp);</span><br><span class="line">    grammar.add(<span class="string">&quot;&lt;Exp&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> intType;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Every recursion will return an <code>intType</code>, which symbolize the final type of the expression.</p>
<p>Because the terms of one expression must be the same type, so I return only one of them.</p>
<p>This is the exit of the recursion. It will return a correct type of the expression to the top of the function.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">analyseLVal</span><span class="params">(ArrayList&lt;Word&gt; exp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> intType = <span class="number">0</span>;</span><br><span class="line">    ...</span><br><span class="line">            <span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;LBRACK&quot;</span>)) &#123;</span><br><span class="line">                intType++;</span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">     ...</span><br><span class="line">    <span class="keyword">if</span> (hasSymbol(ident)) &#123;</span><br><span class="line">        <span class="keyword">return</span> getSymbol(ident).getIntType() - intType;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h2><p>In this part, I chose to generate Pcode.</p>
<p>I designed a type of Pcode which is an Inverse Bolan expression stack and symbol table based virtual code.</p>
<p>At the same time, I designed virtual machine to execute them.</p>
<p>The Pcode virtual machine is an imaginary machine used to run Pcode commands. It consists of: A code area (code), an instruction pointer (EIP), a stack, a var_table, a func_table and a label_table.</p>
<p>In the following passage, I will introduce how Pcode executes first and how to produce Pcode next.</p>
<h3 id="Before-Code-3"><a href="#Before-Code-3" class="headerlink" title="Before Code"></a>Before Code</h3><h4 id="How-does-the-virtual-machine-run"><a href="#How-does-the-virtual-machine-run" class="headerlink" title="How does the virtual machine run"></a>How does the virtual machine run</h4><p>First, we need a <code>codes</code> list and a <code>stack</code>(int).</p>
<p>An <code>eip</code>: presents the address of current running code.</p>
<p>A <code>varTable</code>: memorizes the address of the variety in stack.</p>
<p>A <code>funcTable</code>: memorizes the address of the function in codes list.</p>
<p>A <code>labelTable</code>: Memorizes the address of the label in codes list.</p>
<p>Then, run the code one after another and manage the stack.</p>
<h4 id="How-to-distinguish-different-variety"><a href="#How-to-distinguish-different-variety" class="headerlink" title="How to distinguish different variety"></a>How to distinguish different variety</h4><p>Before generate codes, differentiate varieties from different scopes by its only scope number, like: <code>areaID + &quot;_&quot; + curWord.getContent()</code>. In this situation, the variety will not appear more than once in codes, except for recursive function call, which will be solved by push <code>varTable</code> to stack(show later).</p>
<h4 id="Specific-Code-Definition"><a href="#Specific-Code-Definition" class="headerlink" title="Specific Code Definition"></a>Specific Code Definition</h4><p>First, define a class for PCode:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PCode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CodeType type;</span><br><span class="line">    <span class="keyword">private</span> Object value1 = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Object value2 = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It presents one code object, which has a CodeType and two operating values. CodeType is an enum. Value1 and value2 maybe Integer or String or null, which depends on specific code type.</p>
<h5 id="Calculation-Type"><a href="#Calculation-Type" class="headerlink" title="Calculation Type"></a>Calculation Type</h5><p>Two operators:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> b = pop();</span><br><span class="line"><span class="keyword">int</span> a = pop();</span><br><span class="line">push(cal(a,b));</span><br></pre></td></tr></table></figure>

<p>Single operator:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">push(cal(pop()));</span><br></pre></td></tr></table></figure>

<h5 id="VAR"><a href="#VAR" class="headerlink" title="VAR"></a>VAR</h5><p><strong>VAR</strong> command to declare a variable, save the variable name and the address assigned to it in the variable table.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> VAR: &#123;</span><br><span class="line">    Var <span class="keyword">var</span> = <span class="keyword">new</span> Var(stack.size());</span><br><span class="line">    varTable.put((String) code.getValue1(), <span class="keyword">var</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Var.class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Var</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> dimension = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> dim1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> dim2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="DIMVAR"><a href="#DIMVAR" class="headerlink" title="DIMVAR"></a>DIMVAR</h5><p><strong>DIMVAR</strong> command to declare an array. Set the dimension information of the var.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> DIMVAR: &#123;</span><br><span class="line">    Var <span class="keyword">var</span> = getVar((String) code.getValue1());</span><br><span class="line">    <span class="keyword">int</span> n = (<span class="keyword">int</span>) code.getValue2();</span><br><span class="line">    <span class="keyword">var</span>.setDimension(n);</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> i = pop();</span><br><span class="line">        <span class="keyword">var</span>.setDim1(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> j = pop(), i = pop();</span><br><span class="line">        <span class="keyword">var</span>.setDim1(i);</span><br><span class="line">        <span class="keyword">var</span>.setDim2(j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="PLACEHOLDER"><a href="#PLACEHOLDER" class="headerlink" title="PLACEHOLDER"></a>PLACEHOLDER</h5><p><strong>PLACEHOLDER</strong> command to grow the stack down, allocate the new space to the variety and array.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> PLACEHOLDER: &#123;</span><br><span class="line">    Var <span class="keyword">var</span> = getVar((String) code.getValue1());</span><br><span class="line">    <span class="keyword">int</span> n = (<span class="keyword">int</span>) code.getValue2();</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">        push(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">var</span>.getDim1(); i++) &#123;</span><br><span class="line">            push(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">var</span>.getDim1() * <span class="keyword">var</span>.getDim2(); i++) &#123;</span><br><span class="line">            push(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h5><p>Calculation type: pop the stack top once or twice, calculate them and push again.</p>
<p>Jump Type: When it’s command about jump, just check if the condition is satisfied and change the <code>eip</code>.</p>
<p>Function call: as follows</p>
<h4 id="Function-call-procedure"><a href="#Function-call-procedure" class="headerlink" title="Function call procedure"></a>Function call procedure</h4><p>First, before function call, there will be some parameters to be pushed into the stack. Each will be followed by a <code>RPARA</code> command, which memorize the address of the previous variety. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> RPARA: &#123;</span><br><span class="line">    <span class="keyword">int</span> n = (<span class="keyword">int</span>) code.getValue1();</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">        rparas.add(stack.size() - <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        rparas.add(stack.get(stack.size() - <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Second, function <code>CALL</code>.</p>
<p>Memorize the eip, stack top address, and information about the function(In fact, they will be pushed into stack too). Then update the <code>varTable</code> and <code>eip</code>.  Ready for execute function. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> CALL: &#123;</span><br><span class="line">    Func func = funcTable.get((String) code.getValue1());</span><br><span class="line">    retInfos.add(<span class="keyword">new</span> RetInfo(eip, varTable, stack.size() - <span class="number">1</span>, func.getArgs(), func.getArgs(), nowArgsNum));</span><br><span class="line">    eip = func.getIndex();</span><br><span class="line">    varTable = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    callArgsNum = func.getArgs();</span><br><span class="line">    nowArgsNum = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, return when it’s <code>RET</code></p>
<p>Restore <code>eip</code>, <code>varTable</code> from <code>RetInfo</code>, clear the new information pushed when function in the stack.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> RET: &#123;</span><br><span class="line">    <span class="keyword">int</span> n = (<span class="keyword">int</span>) code.getValue1();</span><br><span class="line">    RetInfo info = retInfos.remove(retInfos.size() - <span class="number">1</span>);</span><br><span class="line">    eip = info.getEip();</span><br><span class="line">    varTable = info.getVarTable();</span><br><span class="line">    callArgsNum = info.getCallArgsNum();</span><br><span class="line">    nowArgsNum = info.getNowArgsNum();</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        stack.subList(info.getStackPtr() + <span class="number">1</span> - info.getParaNum(), stack.size() - <span class="number">1</span>).clear();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        stack.subList(info.getStackPtr() + <span class="number">1</span> - info.getParaNum(), stack.size()).clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Value-or-Address"><a href="#Value-or-Address" class="headerlink" title="Value or Address"></a>Value or Address</h4><p>Push value or address of the variety is an important thing, it depends on what I need, which will be presented when I describe how to generate codes.</p>
<p>The command action is as follows(<code>getAddress</code> is used for get the address of the previous variety ).</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> VALUE: &#123;</span><br><span class="line">    Var <span class="keyword">var</span> = getVar((String) code.getValue1());</span><br><span class="line">    <span class="keyword">int</span> n = (<span class="keyword">int</span>) code.getValue2();</span><br><span class="line">    <span class="keyword">int</span> address = getAddress(<span class="keyword">var</span>, n);</span><br><span class="line">    push(stack.get(address));</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">case</span> ADDRESS: &#123;</span><br><span class="line">    Var <span class="keyword">var</span> = getVar((String) code.getValue1());</span><br><span class="line">    <span class="keyword">int</span> n = (<span class="keyword">int</span>) code.getValue2();</span><br><span class="line">    <span class="keyword">int</span> address = getAddress(<span class="keyword">var</span>, n);</span><br><span class="line">    push(address);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Code-Generate"><a href="#Code-Generate" class="headerlink" title="Code Generate"></a>Code Generate</h4><p>Code generated from the grammatical analyst procedure.</p>
<h5 id="Declaration"><a href="#Declaration" class="headerlink" title="Declaration"></a>Declaration</h5><p>There is no need to distinguish const and var. When declare a variety, just new a variety and let it point to the stack top. Then if it has an initialization, just push the values one after another. If not, add a <code>PLACEHOLDER</code> command to push something(I push 0) to the stack to hold the place.</p>
<h5 id="Assign-sentence"><a href="#Assign-sentence" class="headerlink" title="Assign sentence"></a>Assign sentence</h5><p>In this situation, first calculate and push the address of the variety to the stack top. Then analyze expressions. After that, there are only two number in the stack, which are address and value. Assign the value to the address.</p>
<h5 id="Condition-control-sentence"><a href="#Condition-control-sentence" class="headerlink" title="Condition control sentence"></a>Condition control sentence</h5><p>First, generate labels. Then, place jump sentences in the proper places.</p>
<p>labels about if and while will be generated and then stored in a stack type structure. like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">whileLabels.add(<span class="keyword">new</span> HashMap&lt;&gt;());</span><br><span class="line">whileLabels.get(whileLabels.size() - <span class="number">1</span>).put(<span class="string">&quot;while&quot;</span>, labelGenerator.getLabel(<span class="string">&quot;while&quot;</span>));</span><br><span class="line">whileLabels.get(whileLabels.size() - <span class="number">1</span>).put(<span class="string">&quot;while_end&quot;</span>, labelGenerator.getLabel(<span class="string">&quot;while_end&quot;</span>));</span><br><span class="line">whileLabels.get(whileLabels.size() - <span class="number">1</span>).put(<span class="string">&quot;while_block&quot;</span>, labelGenerator.getLabel(<span class="string">&quot;while_block&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>Take if as example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;IFTK&quot;</span>)) &#123;</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.LABEL, ifLabels.get(ifLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;if&quot;</span>)));</span><br><span class="line">    ...</span><br><span class="line">    analyseCond(<span class="string">&quot;IFTK&quot;</span>);</span><br><span class="line">    ...</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.JZ, ifLabels.get(ifLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;else&quot;</span>)));</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.LABEL, ifLabels.get(ifLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;if_block&quot;</span>)));</span><br><span class="line">    analyseStmt();</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.JMP, ifLabels.get(ifLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;if_end&quot;</span>)));</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.LABEL, ifLabels.get(ifLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;else&quot;</span>)));</span><br><span class="line">    <span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;ELSETK&quot;</span>)) &#123;</span><br><span class="line">        getWord(); <span class="comment">//else</span></span><br><span class="line">        analyseStmt();</span><br><span class="line">    &#125;</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.LABEL, ifLabels.get(ifLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;if_end&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>while:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;WHILETK&quot;</span>)) &#123;</span><br><span class="line">    ...</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.LABEL, whileLabels.get(whileLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;while&quot;</span>)));</span><br><span class="line">    ...</span><br><span class="line">    analyseCond(<span class="string">&quot;WHILETK&quot;</span>);</span><br><span class="line">    ...</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.JZ, whileLabels.get(whileLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;while_end&quot;</span>)));</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.LABEL, whileLabels.get(whileLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;while_block&quot;</span>)));</span><br><span class="line">    analyseStmt();</span><br><span class="line">    ...</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.JMP, whileLabels.get(whileLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;while&quot;</span>)));</span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.LABEL, whileLabels.get(whileLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;while_end&quot;</span>)));</span><br><span class="line">    whileLabels.remove(whileLabels.size() - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// break</span></span><br><span class="line"><span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;BREAKTK&quot;</span>)) &#123;</span><br><span class="line">    getWord();<span class="comment">//break</span></span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.JMP, whileLabels.get(whileLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;while_end&quot;</span>)));</span><br><span class="line"> 		...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// continue</span></span><br><span class="line"><span class="keyword">if</span> (word.typeEquals(<span class="string">&quot;CONTINUETK&quot;</span>)) &#123;</span><br><span class="line">    getWord();<span class="comment">//continue</span></span><br><span class="line">    codes.add(<span class="keyword">new</span> PCode(CodeType.JMP, whileLabels.get(whileLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;while&quot;</span>)));</span><br><span class="line">    ...</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="After-Code-3"><a href="#After-Code-3" class="headerlink" title="After Code"></a>After Code</h3><p>Because of some runtime errors and information shortages, I added and removed some Pcode. At the same, there are some new troubles about address pass and short circuit calculation.</p>
<h4 id="Specific-Code-Definition-1"><a href="#Specific-Code-Definition-1" class="headerlink" title="Specific Code Definition"></a>Specific Code Definition</h4><p>In Operation, <code>push()</code> means put value into the top of the stack. <code>pop()</code> means pop the value from the top of the stack.</p>
<h5 id="Common-Type"><a href="#Common-Type" class="headerlink" title="Common Type"></a>Common Type</h5><table>
<thead>
<tr>
<th>CodeType</th>
<th>Value1</th>
<th>Value2</th>
<th>Operation</th>
</tr>
</thead>
<tbody><tr>
<td>LABEL</td>
<td>Label_name</td>
<td>Set  a label</td>
<td></td>
</tr>
<tr>
<td>VAR</td>
<td>Ident_name</td>
<td>Declare  a variety</td>
<td></td>
</tr>
<tr>
<td>PUSH</td>
<td>Ident_name/Digit</td>
<td>push(value1)</td>
<td></td>
</tr>
<tr>
<td>POP</td>
<td>Address</td>
<td>Ident_name</td>
<td>*value1 = value2</td>
</tr>
<tr>
<td>JZ</td>
<td>Label_name</td>
<td></td>
<td>Jump if stack top is zero</td>
</tr>
<tr>
<td>JNZ</td>
<td>Label_name</td>
<td></td>
<td>Jump if stack top is not zero</td>
</tr>
<tr>
<td>JMP</td>
<td>Label_name</td>
<td></td>
<td>Jump unconditionally</td>
</tr>
<tr>
<td>MAIN</td>
<td></td>
<td></td>
<td>Main function label</td>
</tr>
<tr>
<td>FUNC</td>
<td></td>
<td></td>
<td>Function label</td>
</tr>
<tr>
<td>ENDFUNC</td>
<td></td>
<td></td>
<td>End of function label</td>
</tr>
<tr>
<td>PARA</td>
<td>Ident_name</td>
<td>Type</td>
<td>Parameters</td>
</tr>
<tr>
<td>RET</td>
<td>Return value or not</td>
<td></td>
<td>Function return</td>
</tr>
<tr>
<td>CALL</td>
<td>Function name</td>
<td></td>
<td>Function call</td>
</tr>
<tr>
<td>RPARA</td>
<td>Type</td>
<td></td>
<td>Get parameters ready for function call</td>
</tr>
<tr>
<td>GETINT</td>
<td></td>
<td></td>
<td>Get a integer and put it into stack top</td>
</tr>
<tr>
<td>PRINT</td>
<td>String</td>
<td>Para num</td>
<td>Pop values and print.</td>
</tr>
<tr>
<td>DIMVAR</td>
<td>Ident_name</td>
<td>Type</td>
<td>Set dimension info for array variety</td>
</tr>
<tr>
<td>VALUE</td>
<td>Ident_name</td>
<td>Type</td>
<td>Get the variety value</td>
</tr>
<tr>
<td>ADDRESS</td>
<td>Ident_name</td>
<td>Type</td>
<td>Get the variety address</td>
</tr>
<tr>
<td>PLACEHOLDER</td>
<td></td>
<td></td>
<td>Push something to hold places</td>
</tr>
<tr>
<td>EXIT</td>
<td></td>
<td></td>
<td>Exit</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>CodeType</th>
<th>Value1</th>
<th>Value2</th>
<th>Operation</th>
</tr>
</thead>
<tbody><tr>
<td>ADD</td>
<td></td>
<td></td>
<td>+</td>
</tr>
<tr>
<td>SUB</td>
<td></td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>MUL</td>
<td></td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>DIV</td>
<td></td>
<td></td>
<td>/</td>
</tr>
<tr>
<td>MOD</td>
<td></td>
<td></td>
<td>%</td>
</tr>
<tr>
<td>CMPEQ</td>
<td></td>
<td></td>
<td>==</td>
</tr>
<tr>
<td>CMPNE</td>
<td></td>
<td></td>
<td>!=</td>
</tr>
<tr>
<td>CMPGT</td>
<td></td>
<td></td>
<td>&gt;</td>
</tr>
<tr>
<td>CMPLT</td>
<td></td>
<td></td>
<td>&lt;</td>
</tr>
<tr>
<td>CMPGE</td>
<td></td>
<td></td>
<td>&gt;=</td>
</tr>
<tr>
<td>CMPLE</td>
<td></td>
<td></td>
<td>&lt;=</td>
</tr>
<tr>
<td>AND</td>
<td></td>
<td></td>
<td>&amp;&amp;</td>
</tr>
<tr>
<td>OR</td>
<td></td>
<td></td>
<td>||</td>
</tr>
<tr>
<td>NOT</td>
<td></td>
<td></td>
<td>!</td>
</tr>
<tr>
<td>NEG</td>
<td></td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>POS</td>
<td></td>
<td></td>
<td>+</td>
</tr>
</tbody></table>
<h4 id="short-circuit-calculation"><a href="#short-circuit-calculation" class="headerlink" title="short circuit calculation"></a>short circuit calculation</h4><p>There are two situations I need to use short circuit calculation :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">if</span>(a&amp;&amp;b) <span class="comment">// a is false</span></span><br><span class="line"><span class="number">2.</span> <span class="keyword">if</span>(a||b) <span class="comment">// b is true</span></span><br></pre></td></tr></table></figure>

<p>This seems not an easy thing and I acutally spent lots of time to solve it.</p>
<p>My method is as follows:</p>
<p>First, when I analyze <code>analyseLOrExp</code>, every <code>analyseLAndExp</code> will be followed by a <code>JNZ</code>, which is used for detect if the cond is false. If it is, jump to the if body label. At the same time, I generated cond label, which is ready for the <code>analyseLAndExp</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">analyseLOrExp</span><span class="params">(ArrayList&lt;Word&gt; exp, String from)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">for</span> (...) &#123;</span><br><span class="line">        ...</span><br><span class="line">        String label = labelGenerator.getLabel(<span class="string">&quot;cond_&quot;</span> + i);</span><br><span class="line">        analyseLAndExp(exp1, from, label);</span><br><span class="line">        codes.add(<span class="keyword">new</span> PCode(CodeType.LABEL, label));</span><br><span class="line">        <span class="keyword">if</span> (...) &#123;</span><br><span class="line">            codes.add(<span class="keyword">new</span> PCode(CodeType.OR));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (...) &#123;</span><br><span class="line">            <span class="keyword">if</span> (...) &#123;</span><br><span class="line">                codes.add(<span class="keyword">new</span> PCode(CodeType.JNZ, ifLabels.get(ifLabels.size() - <span class="number">1</span>).get(<span class="string">&quot;if_block&quot;</span>)));</span><br><span class="line">            &#125;</span><br><span class="line">          ...</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In the <code>analyseLAndExp</code>, every <code>analyseEqExp</code> will be followed by a <code>JZ</code>, which is used for detect if the cond is true. If it is, jump to the cond label I set just now.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">analyseLAndExp</span><span class="params">(ArrayList&lt;Word&gt; exp, String from, String label)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">for</span> (...) &#123;</span><br><span class="line">        ...</span><br><span class="line">        analyseEqExp(exp1);</span><br><span class="line">        <span class="keyword">if</span> (...) &#123;</span><br><span class="line">            codes.add(<span class="keyword">new</span> PCode(CodeType.AND));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (...) &#123;</span><br><span class="line">            <span class="keyword">if</span> (...) &#123;</span><br><span class="line">                codes.add(<span class="keyword">new</span> PCode(CodeType.JZ, label));</span><br><span class="line">            &#125; </span><br><span class="line">          ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By these means, short circuit calculation is solved.</p>
<h2 id="总结感想"><a href="#总结感想" class="headerlink" title="总结感想"></a>总结感想</h2><p>[[编译实验总结感想]]</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://atksoto.com/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="soto">
      <meta itemprop="description" content="SOTO的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SOTO-BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/undefined/" class="post-title-link" itemprop="url">格式化输出</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-08 15:09:00" itemprop="dateCreated datePublished" datetime="2021-11-08T15:09:00+08:00">2021-11-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-01 15:49:46" itemprop="dateModified" datetime="2021-12-01T15:49:46+08:00">2021-12-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a>格式化输出</h3><h5 id="进制"><a href="#进制" class="headerlink" title="进制"></a>进制</h5><p>%o —— oct 八进制<br>%d —— dec 十进制<br>%x —— hex 十六进制</p>
<h5 id="浮点数保留位数"><a href="#浮点数保留位数" class="headerlink" title="浮点数保留位数"></a>浮点数保留位数</h5><p>%.3f，保留3位小数位<br>%.3e，保留3位小数位，使用科学计数法<br>%.3g，保留3位有效数字，使用小数或科学计数法</p>
<h5 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h5><p>%10s——右对齐，占位符10位<br>%-10s——左对齐，占位符10位<br>%.2s——截取2位字符串<br>%10.2s——10位占位符，截取两位字符串</p>
<h5 id="整数前0"><a href="#整数前0" class="headerlink" title="整数前0"></a>整数前0</h5><p>%03d——补3个前导0的十进制</p>
<p>%03x——补3个前导0的十六进制</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://atksoto.com/posts/11219/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="soto">
      <meta itemprop="description" content="SOTO的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SOTO-BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/11219/" class="post-title-link" itemprop="url">2021年11月的第一场雪</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-07 02:04:08" itemprop="dateCreated datePublished" datetime="2021-11-07T02:04:08+08:00">2021-11-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-30 21:42:00" itemprop="dateModified" datetime="2021-11-30T21:42:00+08:00">2021-11-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <iframe allow="autoplay *; encrypted-media *; fullscreen *" frameborder="0" height="150" style="width:100%;max-width:660px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/album/the-four-seasons-concerto-no-4-in-f-minor-rv-297/883897569?i=883897598&l=en"></iframe>

<p>真的很冷</p>
<p>今天大家的关注点都在S赛，我也未能免俗参与其中</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://atksoto.com/posts/53100/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="soto">
      <meta itemprop="description" content="SOTO的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SOTO-BLOG">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/53100/" class="post-title-link" itemprop="url">Memo</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-28 17:29:00" itemprop="dateCreated datePublished" datetime="2021-10-28T17:29:00+08:00">2021-10-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-01 16:36:46" itemprop="dateModified" datetime="2021-12-01T16:36:46+08:00">2021-12-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Memo"><a href="#Memo" class="headerlink" title="Memo"></a>Memo</h1><p>Memo用于随时记录，记录生活中的某一刻，记录今天的心情，或是记录看过的一部电影，一本书，留下自己此时的感想，并在自己最爱的电影或书籍的二刷三刷后再次记录下时间和新的想法…</p>
<p>灵感来源于豆瓣，比起豆瓣的功能多出的个人需求为：需要一个简洁没有过量冗余信息的片单和书单记录软件，记录二刷，三刷的时间，以及想要随时记录每一天，并且在几年后回顾那年今日，留一些感动与感慨，让每一天都值得被纪念，故开发此软件。</p>
<h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><p><img src="/posts/53100/image-20211120173053786.png"></p>
<p>（介绍及短评摘自豆瓣，侵删）</p>
<p><img src="/posts/53100/008i3skNly1gwlr5i3osjj30u010ujtt.jpg"></p>
<p>Mac, iPad适配</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="主页面"><a href="#主页面" class="headerlink" title="主页面"></a>主页面</h3><p>主界面分为3个标签：主页，电影，书籍</p>
<h5 id="主页"><a href="#主页" class="headerlink" title="主页"></a>主页</h5><p><img src="/posts/53100/008i3skNly1gwlqj9g2ltj30pi0tkq5a.jpg"></p>
<p><img src="/posts/53100/008i3skNly1gwlqj9pbc4j30pk0vowg3.jpg"></p>
<h5 id="电影"><a href="#电影" class="headerlink" title="电影"></a>电影</h5><p>这里是你看过的电影片单，你可以随时看到你标记过的所有电影，以及在任何时候添加一个新的电影进入你的片单</p>
<p>进入某条电影，如果你输入的电影在数据库之中（数据来自豆瓣，侵删），你就可以看到关于电影的介绍：演员，导演，豆瓣评分，类别，介绍等，以及最重要的，在最下方，看到你第一次观看的时间以及感想</p>
<p>当然，点击此方框，你可以进入到第二次标记的页面，记录下你的第二次观影以及新的感想</p>
<p><img src="/posts/53100/008i3skNly1gwlr3yyccmj30u00yfdi5.jpg"></p>
<p><img src="/posts/53100/008i3skNly1gwuznrfz7oj30u00xmju5.jpg"></p>
<h5 id="书籍"><a href="#书籍" class="headerlink" title="书籍"></a>书籍</h5><p>类似电影，这里是你的书单，你可以添加你看过的书籍，并且记录第n次阅读的体验，相信每一次阅读，都会发现不少新东西</p>
<p><img src="/posts/53100/008i3skNly1gwlr1ixi5pj30u010gmys.jpg"></p>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><ul>
<li>标记某一天的感受</li>
<li>标记某本电影，某本书</li>
<li>多次标记某电影和书的观看时间和感受</li>
<li>自动展示电影和书籍的相关图片与简介</li>
<li>图文并茂的主页卡片展示设计</li>
<li>在主页展示进一个月看过的电影</li>
<li>在主页展示今天以及那年今日的感想</li>
</ul>
<h2 id="架构以及实现"><a href="#架构以及实现" class="headerlink" title="架构以及实现"></a>架构以及实现</h2><p>源代码文件共25个</p>
<p>主要分为三个部分：Controller Model Views</p>
<p><img src="/posts/53100/008i3skNly1gwuz8sdizwj306r0kx3z9.jpg" alt="image-20211027232454144"></p>
<h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><p>一些静态函数，实现点击界面按钮后的某些后端反应以及后端用到的函数，如图像获取，日期格式化，Mark筛选等</p>
<p>其中图片的读取使用了异步加载url的方式，如果url没有解析成功将不会显示图片</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageLoader</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> didChange <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Data</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">    <span class="keyword">var</span> data <span class="operator">=</span> <span class="type">Data</span>() &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            didChange.send(data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">urlString</span>: <span class="type">String</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: urlString) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> task <span class="operator">=</span> <span class="type">URLSession</span>.shared.dataTask(with: url) &#123; (data, response, error) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> data <span class="operator">=</span> data <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                <span class="keyword">self</span>.data <span class="operator">=</span> data</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        task.resume()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h4><p>主要用到的对象为Mark：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mark</span>: <span class="title">Codable</span>, <span class="title">Identifiable</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> index:<span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> type:<span class="type">ModelType</span> <span class="operator">=</span> <span class="type">ModelType</span>.<span class="type">NONE</span></span><br><span class="line">    <span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">var</span> dates: [<span class="type">Date</span>] <span class="operator">=</span> []</span><br><span class="line">    <span class="keyword">var</span> feeling <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">index</span>: <span class="type">Int</span>,<span class="params">type</span>:<span class="type">ModelType</span>, <span class="params">name</span>:<span class="type">String</span>, <span class="params">date</span>:<span class="type">Date</span>, <span class="params">feeling</span>:<span class="type">String</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.index <span class="operator">=</span> index</span><br><span class="line">        <span class="keyword">self</span>.type <span class="operator">=</span> type</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">        <span class="keyword">self</span>.dates.append(date)</span><br><span class="line">        <span class="keyword">self</span>.feeling <span class="operator">=</span> feeling</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Movie, Book 为电影和书籍的简介，不进行重复的展示</p>
<p>他们遵循MarkableObject协议，用于在展示Mark详情时读取object后再作类型判断</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Movie</span>: <span class="title">Hashable</span>, <span class="title">Codable</span>, <span class="title">Identifiable</span>, <span class="title">MarkableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">		<span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ModelData负责数据存储的任务</p>
<p>用到了自带的UserDefaults.standard存储数据</p>
<p>movies和books分别为电影和书籍数据集，内置在app中</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelData</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> moviesDict <span class="operator">=</span> getMoviesDict(movies: load(<span class="string">&quot;movies.json&quot;</span>))</span><br><span class="line">    <span class="keyword">var</span> booksDict <span class="operator">=</span> getBooksDict(books: load(<span class="string">&quot;books.json&quot;</span>))</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> marks: [<span class="type">Mark</span>] <span class="operator">=</span> []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">init</span>()</span> &#123;</span><br><span class="line">        loadMarks()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadMarks</span>()</span> &#123;</span><br><span class="line">        marks <span class="operator">=</span> <span class="type">UserDefaults</span>.standard.object(([<span class="type">Mark</span>]).<span class="keyword">self</span>, with: <span class="string">&quot;Marks&quot;</span>) <span class="operator">??</span> []</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">saveMarks</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> standard <span class="operator">=</span> <span class="type">UserDefaults</span>.standard</span><br><span class="line">        standard.set(object: marks, forKey: <span class="string">&quot;Marks&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ModelType为枚举类型，用于Mark类型判断</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ModelType</span>: <span class="title">String</span>, <span class="title">Codable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">NONE</span> <span class="operator">=</span> <span class="string">&quot;无&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">MOVIE</span> <span class="operator">=</span> <span class="string">&quot;电影&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">BOOK</span> <span class="operator">=</span> <span class="string">&quot;书籍&quot;</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">DAY</span> <span class="operator">=</span> <span class="string">&quot;今天&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Views"><a href="#Views" class="headerlink" title="Views"></a>Views</h4><p>界面UI</p>
<p>用到了environmentObject来同步各个界面的数据</p>
<p>父界面给子界面传递@Binding的变量，子界面拿到引用直接演示和修改，不会出现数据不同步的问题</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MemoApp</span>: <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">private</span> <span class="keyword">var</span> modelData <span class="operator">=</span> <span class="type">ModelData</span>()</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Scene</span> &#123;</span><br><span class="line">        <span class="type">WindowGroup</span> &#123;</span><br><span class="line">            <span class="type">ContentView</span>()</span><br><span class="line">                    .environmentObject(modelData)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="MainMenu"><a href="#MainMenu" class="headerlink" title="MainMenu"></a>MainMenu</h5><p>MarkList: Mark列表，即展示电影和书籍列表</p>
<p>使用NavigationLink，向子界面：MarkDetail传递mark的引用</p>
<p><img src="/posts/53100/image-20211027234131178.png" alt="image-20211027234131178"></p>
<p>HomeView: 主界面</p>
<h5 id="Mark"><a href="#Mark" class="headerlink" title="Mark"></a>Mark</h5><p>关于Mark的界面</p>
<p>MarkDetail: 一个Mark的详情</p>
<p>大部分子界面都如此UI一样，引入modelData的环境变量，承接上一级传下来的@Binding变量，实现数据的同步</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> modelData: <span class="type">ModelData</span></span><br><span class="line"><span class="meta">@Binding</span> <span class="keyword">var</span> mark: <span class="type">Mark</span></span><br></pre></td></tr></table></figure>

<p>其中要进行object的解析，如果用户输入能索引本地数据集的一个条目上，将会展示此object的详情</p>
<p><img src="/posts/53100/image-20211027234003022.png" alt="image-20211027234003022"></p>
<p>MarkAdd: Mark增加界面</p>
<p>MarkEdit: Mark修改界面</p>
<p>MarkToday: 标记今天界面</p>
<p>这三个UI都用到了@State来实时同步Form表单中的信息</p>
<p>以至于用户输入能够及时的反应在变量上并且写入modelData</p>
<p><img src="/posts/53100/image-20211027234224510.png" alt="image-20211027234224510"></p>
<h4 id="Kit"><a href="#Kit" class="headerlink" title="Kit"></a>Kit</h4><p>其他组件</p>
<p><img src="/posts/53100/image-20211027234350311.png" alt="image-20211027234350311"></p>
<p>电影和书籍详情，时间线，圆形和方形图片，卡片组件等</p>
<p>均已展示在各个页面中</p>
<h4 id><a href="#" class="headerlink" title></a></h4>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">soto</p>
  <div class="site-description" itemprop="description">SOTO的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">64</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">soto</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
